{"title":"Chapter 3.4: Effect Modification and Heterogeneous Treatment Effects","markdown":{"yaml":{"title":"Chapter 3.4: Effect Modification and Heterogeneous Treatment Effects","format":"html"},"headingText":"Chapter 3.4","containsRefs":false,"markdown":"\n\n\n\n## TO DO:\n\n- incorporate Haodongs methods and causal forest\n\n## Effect Modification and Heterogeneous Treatment Effects  \n*Identifying who benefits most (or least) from treatment*\n\nCausal inference is not only about estimating *average* treatment effects.  \nIn many scientific and regulatory settings, we want to know:\n\n> **Does the treatment work differently for different types of patients?**\n\nThis phenomenon is known as **effect modification** or **treatment-effect heterogeneity (HTE)**.\n\nIn this chapter, you’ll learn:\n\n1. Conceptual foundations of effect modification  \n2. How to define subgroup-specific causal estimands  \n3. TMLE-based approaches to effect heterogeneity  \n4. Machine-learning approaches, focusing on the **causal forest**  \n5. How to interpret heterogeneous effects responsibly  \n6. Diagnostics, uncertainty, and false discovery concerns  \n\nThis chapter builds on the causal roadmap and estimation methods from earlier modules.\n\n---\n\n## 1. Why Study Effect Modification?\n\nThe **average treatment effect (ATE)** answers:  \n> “What is the mean effect of treatment in the population?”\n\nBut patients differ:\n\n- age, sex  \n- comorbidities  \n- biomarkers  \n- baseline risk  \n- genetic variation  \n\nClinically and scientifically relevant questions include:\n\n- *Does our osteoporosis drug reduce fracture risk more in high-risk patients?*  \n- *Are cardiovascular risks higher in patients with chronic kidney disease?*  \n- *Does benefit differ by baseline frailty or prior CVD?*\n\nEffect modification helps answer these individualized or stratified questions.\n\n---\n\n## 2. Causal Estimands for Effect Modification\n\nTo study heterogeneity, we define **conditional average treatment effects (CATE)**.\n\nLet \\(X\\) be a baseline covariate or set of covariates.\n\nThe **CATE** is:\n\n\\[\nCATE(x) = E[Y(1) - Y(0) \\mid X = x].\n\\]\n\nFor categorical variables (e.g., age group):\n\n\\[\nATE_{\text{age<75}} = E[Y(1) - Y(0) \\mid \text{age} < 75],\n\\]\n\nand similarly for other strata.\n\nYour choice of estimand must match the scientific question:\n\n- **Prespecified subgroups** (sex, race, CKD stage)  \n- **Post hoc continuous moderators** (eGFR, age)  \n- **Machine-learned subgroups** (via trees / forests)\n\n---\n\n## 3. Identification Assumptions\n\nEffect modification estimands inherit the same assumptions as the main causal effect:\n\n- **Exchangeability:**  \n  \\(\n  Y(a) \\perp A \\mid W\n  \\)\n- **Positivity:**  \n  Each subgroup must contain both treated and untreated  \n- **Consistency**\n\nAdditionally:\n\n- Moderator variables must be **measured before treatment**  \n- You should avoid conditioning on **post-treatment variables** when defining subgroups\n\n---\n\n## 4. A Workflow for Effect Modification\n\n1. **Define causal estimands** (subgroup-specific ATE, CATE(x))  \n2. **Choose moderators**  \n   - Prespecified vs exploratory  \n3. **Estimate nuisance functions** with SuperLearner  \n4. **Estimate heterogeneous effects** using:\n   - TMLE (subgroup-specific or CATE-targeted)  \n   - Causal forests  \n5. **Quantify uncertainty**  \n6. **Document all steps and prespecifications**\n\nWe now walk through TMLE and causal forest approaches.\n\n---\n\n## 5. TMLE for Subgroup-Specific Effects\n\nFor **prespecified subgroups**, TMLE can estimate:\n\n\\[\nATE_g = E[Y(1) - Y(0) \\mid X_g = 1],\n\\]\n\nwhere \\(X_g\\) indicates membership in subgroup \\(g\\).\n\nExample: ATE among patients younger than 75.\n\n```{r}\nlibrary(tmle)\nlibrary(SuperLearner)\nlibrary(tidyverse)\n\n# Assume dat has columns: Y (outcome), A (treatment), age, cvd, eGFR, etc.\nset.seed(123)\n\ndat <- tibble(\n  Y = rbinom(2000, 1, 0.2),\n  A = rbinom(2000, 1, 0.5),\n  age = rnorm(2000, 75, 6),\n  cvd = rbinom(2000, 1, 0.4),\n  eGFR = rnorm(2000, 60, 15)\n)\n\ndat <- dat %>%\n  mutate(age_under75 = if_else(age < 75, 1, 0))\n\nsl_lib <- c(\"SL.glm\", \"SL.ranger\", \"SL.mean\")\n\ntmle_sub <- tmle(\n  Y = dat$Y[dat$age_under75 == 1],\n  A = dat$A[dat$age_under75 == 1],\n  W = dat %>%\n    filter(age_under75 == 1) %>%\n    select(cvd, eGFR),\n  family = \"binomial\",\n  Q.SL.library = sl_lib,\n  g.SL.library = sl_lib\n)\n\ntmle_sub$estimates$ATE\n```\n\nInterpretation:\n\n> Among patients younger than 75, the TMLE-estimated risk difference is …\n\nThis approach:\n\n- Gives valid subgroup-specific estimates  \n- Leverages SuperLearner for nuisance models  \n\nLimitations:\n\n- Does not provide a *continuous* CATE curve  \n- Requires prespecified groups and adequate sample size in each  \n\n---\n\n## 6. TMLE Extensions for Continuous Effect Modification\n\nFor continuous effect modifiers, you may want:\n\n\\[\nCATE(x) = E[Y(1) - Y(0) \\mid X = x]\n\\]\n\nfor all x (e.g., all ages). TMLE-based approaches often use:\n\n- Projection of the CATE onto basis functions of X (splines, polynomials)\n- Estimation of projection coefficients via TMLE\n- Reconstruction of \\( CATE(x) \\) from the projected function\n\nA typical CATE-TMLE algorithm:\n\n1. Expand \\(X\\) into basis functions \\(h_1(X),\\dots,h_K(X)\\)  \n2. Define target parameters of the form  \n   \\(\\Psi_k = E[(Y(1) - Y(0)) h_k(X)]\\)  \n3. Use TMLE to estimate each \\(\\Psi_k\\)  \n4. Construct \\( \\hat{CATE}(x) = \\sum_k \\hat\\Psi_k h_k(x)\\)\n\nWe won’t fully implement this here (it is mathematically intensive), but you should be aware that:\n\n- TMLE can provide **smooth, doubly robust CATE estimators**  \n- TMLE-based variable importance methods can also quantify **how much** a covariate modifies the treatment effect  \n\n---\n\n## 7. Modern ML Approach: Causal Forests\n\n**Causal forests** are tree-based methods specifically designed to estimate CATEs.\n\nThey extend random forests by:\n\n- Splitting trees to maximize *treatment-effect heterogeneity*  \n- Using “honest” sample splitting (training vs estimation sets)  \n- Averaging across many trees to obtain smooth CATE estimates\n\n### 7.1 Why Causal Forests?\n\n- Automatically detect complex, nonlinear interactions  \n- Provide **individual-level CATE estimates** \\( \\hat\tau(x) \\)  \n- Offer approximate pointwise confidence intervals  \n- Useful for exploratory HTE analysis\n\nCaveats:\n\n- Not doubly robust  \n- Interpretation is essentially **associational**, unless we embed it in a rigorous causal framework  \n- Needs the same identification assumptions as other causal estimators\n\n---\n\n## 8. Implementing Causal Forests in R\n\nWe use the `grf` package.\n\n```{r}\n# install.packages(\"grf\")\nlibrary(grf)\n\nset.seed(2028)\n\n# Simulate data with treatment effect heterogeneity\nn <- 3000\nX <- tibble(\n  age = rnorm(n, 75, 6),\n  cvd = rbinom(n, 1, 0.4),\n  risk_score = rnorm(n, 0, 1)\n)\n\nA <- rbinom(n, 1, plogis(-0.5 + 0.2 * X$age - 0.8 * X$risk_score))\n# Treatment effect depends on risk_score\ntau_true <- -0.05 + 0.1 * (X$risk_score > 0)\nY <- rbinom(n, 1, plogis(-2 + tau_true * A + 0.05 * (X$age - 75) + 0.5 * X$cvd))\n\nX_mat <- as.matrix(X)\n\ncf <- causal_forest(\n  X = X_mat,\n  Y = Y,\n  W = A\n)\n\n# Individualized CATE estimates\ntau_hat <- predict(cf)$predictions\n\nsummary(tau_hat)\n```\n\n### Visualizing CATE vs. risk score\n\n**To do** debug\n\n```{r, eval=FALSE}\nplot(X$risk_score, tau_hat,\n     xlab = \"Baseline risk score\",\n     ylab = \"Estimated CATE\",\n     pch = 16, cex = 0.3)\nabline(h = 0, col = \"red\")\n```\n\nYou should see different CATE patterns for low vs high risk scores.\n\n---\n\n## 9. Subgrouping Using CATE Estimates\n\nWe can create subgroups such as:\n\n- “High predicted benefit” vs “low predicted benefit”\n\n```{r}\nthreshold <- median(tau_hat)\n\nres <- X %>%\n  mutate(\n    CATE_hat = tau_hat,\n    group = if_else(CATE_hat > threshold, \"high benefit\", \"low benefit\")\n  )\n\ntable(res$group)\n\nres %>%\n  group_by(group) %>%\n  summarize(\n    mean_CATE = mean(CATE_hat),\n    .groups = \"drop\"\n  )\n```\n\nThis is **exploratory**, not confirmatory.  \nIt can inform:\n\n- Hypothesis generation  \n- Prespecified subgroup definitions in future trials  \n\n---\n\n## 10. Causal Forest vs. TMLE: Which Should You Use?\n\n**TMLE (with SuperLearner):**\n\n- Best for **prespecified** subgroups  \n- CATE-TMLE gives **doubly robust**, efficient CATE estimates  \n- Integrates neatly into a causal estimand framework  \n- More transparent and parameter-focused  \n\n**Causal Forest:**\n\n- Best for **exploratory** heterogeneity  \n- Automatically discovers complex interactions  \n- Provides smooth CATE functions without specifying bases  \n- Good for risk-stratified or personalized-medicine questions  \n\n### Practical pattern:\n\n1. Use **TMLE** to estimate ATE and pre-planned subgroup effects  \n2. Use **causal forests** to explore residual heterogeneity and generate new hypotheses  \n3. Where consistent patterns are observed, design new confirmatory analyses or studies\n\n---\n\n## 11. Interpretation and Reporting: Avoiding Pitfalls\n\nEffect modification is tempting but dangerous:\n\n- Multiple subgroup comparisons inflate type I error  \n- “Fishing expeditions” can produce spurious heterogeneity  \n- Small subgroup sizes → unstable estimates  \n\nBest practices:\n\n1. **Prespecify main effect modifiers** when possible  \n2. **Correct for multiplicity** (e.g., family-wise error or FDR) if reporting many subgroups  \n3. Emphasize **uncertainty** (wide CIs are expected)  \n4. Treat causal forest findings as **exploratory** unless prespecified or replicated  \n5. Always present the **overall ATE** alongside any heterogeneity results  \n\n---\n\n## 12. Example: Combining TMLE and Causal Forests\n\n```{r}\n# Step 1: ATE with TMLE\nsl_lib <- c(\"SL.glm\", \"SL.ranger\", \"SL.mean\")\n\ntmle_ate <- tmle(\n  Y = Y,\n  A = A,\n  W = X,\n  family = \"binomial\",\n  Q.SL.library = sl_lib,\n  g.SL.library = sl_lib\n)\n\ntmle_ate$estimates$ATE\n\n# Step 2: CATEs with causal forest (already computed as tau_hat)\nsummary(tau_hat)\n```\n\n- TMLE gives a **population-level effect** (with solid identifiability and efficiency).\n- Causal forest gives **individual-level estimated CATEs** to explore how effects vary.\n\n---\n\n## 13. Summary\n\nIn this chapter, you learned:\n\n- How to define causal estimands for effect modification and CATEs  \n- How to estimate subgroup-specific effects via TMLE  \n- How TMLE can be extended to continuous moderators using projection / variable importance frameworks  \n- How causal forests provide flexible, ML-driven CATE estimates  \n- How to interpret heterogeneous effects carefully in real-world and regulatory contexts  \n\nEffect modification analysis is powerful but fragile. Combining **TMLE** for confirmatory, parameter-focused inference and **causal forests** for exploratory, data-adaptive heterogeneity learning often yields the most insightful and responsible use of HTE methods.\n\n```{r}\nsessionInfo()\n```\n","srcMarkdownNoYaml":"\n\n\n# Chapter 3.4  \n\n## TO DO:\n\n- incorporate Haodongs methods and causal forest\n\n## Effect Modification and Heterogeneous Treatment Effects  \n*Identifying who benefits most (or least) from treatment*\n\nCausal inference is not only about estimating *average* treatment effects.  \nIn many scientific and regulatory settings, we want to know:\n\n> **Does the treatment work differently for different types of patients?**\n\nThis phenomenon is known as **effect modification** or **treatment-effect heterogeneity (HTE)**.\n\nIn this chapter, you’ll learn:\n\n1. Conceptual foundations of effect modification  \n2. How to define subgroup-specific causal estimands  \n3. TMLE-based approaches to effect heterogeneity  \n4. Machine-learning approaches, focusing on the **causal forest**  \n5. How to interpret heterogeneous effects responsibly  \n6. Diagnostics, uncertainty, and false discovery concerns  \n\nThis chapter builds on the causal roadmap and estimation methods from earlier modules.\n\n---\n\n## 1. Why Study Effect Modification?\n\nThe **average treatment effect (ATE)** answers:  \n> “What is the mean effect of treatment in the population?”\n\nBut patients differ:\n\n- age, sex  \n- comorbidities  \n- biomarkers  \n- baseline risk  \n- genetic variation  \n\nClinically and scientifically relevant questions include:\n\n- *Does our osteoporosis drug reduce fracture risk more in high-risk patients?*  \n- *Are cardiovascular risks higher in patients with chronic kidney disease?*  \n- *Does benefit differ by baseline frailty or prior CVD?*\n\nEffect modification helps answer these individualized or stratified questions.\n\n---\n\n## 2. Causal Estimands for Effect Modification\n\nTo study heterogeneity, we define **conditional average treatment effects (CATE)**.\n\nLet \\(X\\) be a baseline covariate or set of covariates.\n\nThe **CATE** is:\n\n\\[\nCATE(x) = E[Y(1) - Y(0) \\mid X = x].\n\\]\n\nFor categorical variables (e.g., age group):\n\n\\[\nATE_{\text{age<75}} = E[Y(1) - Y(0) \\mid \text{age} < 75],\n\\]\n\nand similarly for other strata.\n\nYour choice of estimand must match the scientific question:\n\n- **Prespecified subgroups** (sex, race, CKD stage)  \n- **Post hoc continuous moderators** (eGFR, age)  \n- **Machine-learned subgroups** (via trees / forests)\n\n---\n\n## 3. Identification Assumptions\n\nEffect modification estimands inherit the same assumptions as the main causal effect:\n\n- **Exchangeability:**  \n  \\(\n  Y(a) \\perp A \\mid W\n  \\)\n- **Positivity:**  \n  Each subgroup must contain both treated and untreated  \n- **Consistency**\n\nAdditionally:\n\n- Moderator variables must be **measured before treatment**  \n- You should avoid conditioning on **post-treatment variables** when defining subgroups\n\n---\n\n## 4. A Workflow for Effect Modification\n\n1. **Define causal estimands** (subgroup-specific ATE, CATE(x))  \n2. **Choose moderators**  \n   - Prespecified vs exploratory  \n3. **Estimate nuisance functions** with SuperLearner  \n4. **Estimate heterogeneous effects** using:\n   - TMLE (subgroup-specific or CATE-targeted)  \n   - Causal forests  \n5. **Quantify uncertainty**  \n6. **Document all steps and prespecifications**\n\nWe now walk through TMLE and causal forest approaches.\n\n---\n\n## 5. TMLE for Subgroup-Specific Effects\n\nFor **prespecified subgroups**, TMLE can estimate:\n\n\\[\nATE_g = E[Y(1) - Y(0) \\mid X_g = 1],\n\\]\n\nwhere \\(X_g\\) indicates membership in subgroup \\(g\\).\n\nExample: ATE among patients younger than 75.\n\n```{r}\nlibrary(tmle)\nlibrary(SuperLearner)\nlibrary(tidyverse)\n\n# Assume dat has columns: Y (outcome), A (treatment), age, cvd, eGFR, etc.\nset.seed(123)\n\ndat <- tibble(\n  Y = rbinom(2000, 1, 0.2),\n  A = rbinom(2000, 1, 0.5),\n  age = rnorm(2000, 75, 6),\n  cvd = rbinom(2000, 1, 0.4),\n  eGFR = rnorm(2000, 60, 15)\n)\n\ndat <- dat %>%\n  mutate(age_under75 = if_else(age < 75, 1, 0))\n\nsl_lib <- c(\"SL.glm\", \"SL.ranger\", \"SL.mean\")\n\ntmle_sub <- tmle(\n  Y = dat$Y[dat$age_under75 == 1],\n  A = dat$A[dat$age_under75 == 1],\n  W = dat %>%\n    filter(age_under75 == 1) %>%\n    select(cvd, eGFR),\n  family = \"binomial\",\n  Q.SL.library = sl_lib,\n  g.SL.library = sl_lib\n)\n\ntmle_sub$estimates$ATE\n```\n\nInterpretation:\n\n> Among patients younger than 75, the TMLE-estimated risk difference is …\n\nThis approach:\n\n- Gives valid subgroup-specific estimates  \n- Leverages SuperLearner for nuisance models  \n\nLimitations:\n\n- Does not provide a *continuous* CATE curve  \n- Requires prespecified groups and adequate sample size in each  \n\n---\n\n## 6. TMLE Extensions for Continuous Effect Modification\n\nFor continuous effect modifiers, you may want:\n\n\\[\nCATE(x) = E[Y(1) - Y(0) \\mid X = x]\n\\]\n\nfor all x (e.g., all ages). TMLE-based approaches often use:\n\n- Projection of the CATE onto basis functions of X (splines, polynomials)\n- Estimation of projection coefficients via TMLE\n- Reconstruction of \\( CATE(x) \\) from the projected function\n\nA typical CATE-TMLE algorithm:\n\n1. Expand \\(X\\) into basis functions \\(h_1(X),\\dots,h_K(X)\\)  \n2. Define target parameters of the form  \n   \\(\\Psi_k = E[(Y(1) - Y(0)) h_k(X)]\\)  \n3. Use TMLE to estimate each \\(\\Psi_k\\)  \n4. Construct \\( \\hat{CATE}(x) = \\sum_k \\hat\\Psi_k h_k(x)\\)\n\nWe won’t fully implement this here (it is mathematically intensive), but you should be aware that:\n\n- TMLE can provide **smooth, doubly robust CATE estimators**  \n- TMLE-based variable importance methods can also quantify **how much** a covariate modifies the treatment effect  \n\n---\n\n## 7. Modern ML Approach: Causal Forests\n\n**Causal forests** are tree-based methods specifically designed to estimate CATEs.\n\nThey extend random forests by:\n\n- Splitting trees to maximize *treatment-effect heterogeneity*  \n- Using “honest” sample splitting (training vs estimation sets)  \n- Averaging across many trees to obtain smooth CATE estimates\n\n### 7.1 Why Causal Forests?\n\n- Automatically detect complex, nonlinear interactions  \n- Provide **individual-level CATE estimates** \\( \\hat\tau(x) \\)  \n- Offer approximate pointwise confidence intervals  \n- Useful for exploratory HTE analysis\n\nCaveats:\n\n- Not doubly robust  \n- Interpretation is essentially **associational**, unless we embed it in a rigorous causal framework  \n- Needs the same identification assumptions as other causal estimators\n\n---\n\n## 8. Implementing Causal Forests in R\n\nWe use the `grf` package.\n\n```{r}\n# install.packages(\"grf\")\nlibrary(grf)\n\nset.seed(2028)\n\n# Simulate data with treatment effect heterogeneity\nn <- 3000\nX <- tibble(\n  age = rnorm(n, 75, 6),\n  cvd = rbinom(n, 1, 0.4),\n  risk_score = rnorm(n, 0, 1)\n)\n\nA <- rbinom(n, 1, plogis(-0.5 + 0.2 * X$age - 0.8 * X$risk_score))\n# Treatment effect depends on risk_score\ntau_true <- -0.05 + 0.1 * (X$risk_score > 0)\nY <- rbinom(n, 1, plogis(-2 + tau_true * A + 0.05 * (X$age - 75) + 0.5 * X$cvd))\n\nX_mat <- as.matrix(X)\n\ncf <- causal_forest(\n  X = X_mat,\n  Y = Y,\n  W = A\n)\n\n# Individualized CATE estimates\ntau_hat <- predict(cf)$predictions\n\nsummary(tau_hat)\n```\n\n### Visualizing CATE vs. risk score\n\n**To do** debug\n\n```{r, eval=FALSE}\nplot(X$risk_score, tau_hat,\n     xlab = \"Baseline risk score\",\n     ylab = \"Estimated CATE\",\n     pch = 16, cex = 0.3)\nabline(h = 0, col = \"red\")\n```\n\nYou should see different CATE patterns for low vs high risk scores.\n\n---\n\n## 9. Subgrouping Using CATE Estimates\n\nWe can create subgroups such as:\n\n- “High predicted benefit” vs “low predicted benefit”\n\n```{r}\nthreshold <- median(tau_hat)\n\nres <- X %>%\n  mutate(\n    CATE_hat = tau_hat,\n    group = if_else(CATE_hat > threshold, \"high benefit\", \"low benefit\")\n  )\n\ntable(res$group)\n\nres %>%\n  group_by(group) %>%\n  summarize(\n    mean_CATE = mean(CATE_hat),\n    .groups = \"drop\"\n  )\n```\n\nThis is **exploratory**, not confirmatory.  \nIt can inform:\n\n- Hypothesis generation  \n- Prespecified subgroup definitions in future trials  \n\n---\n\n## 10. Causal Forest vs. TMLE: Which Should You Use?\n\n**TMLE (with SuperLearner):**\n\n- Best for **prespecified** subgroups  \n- CATE-TMLE gives **doubly robust**, efficient CATE estimates  \n- Integrates neatly into a causal estimand framework  \n- More transparent and parameter-focused  \n\n**Causal Forest:**\n\n- Best for **exploratory** heterogeneity  \n- Automatically discovers complex interactions  \n- Provides smooth CATE functions without specifying bases  \n- Good for risk-stratified or personalized-medicine questions  \n\n### Practical pattern:\n\n1. Use **TMLE** to estimate ATE and pre-planned subgroup effects  \n2. Use **causal forests** to explore residual heterogeneity and generate new hypotheses  \n3. Where consistent patterns are observed, design new confirmatory analyses or studies\n\n---\n\n## 11. Interpretation and Reporting: Avoiding Pitfalls\n\nEffect modification is tempting but dangerous:\n\n- Multiple subgroup comparisons inflate type I error  \n- “Fishing expeditions” can produce spurious heterogeneity  \n- Small subgroup sizes → unstable estimates  \n\nBest practices:\n\n1. **Prespecify main effect modifiers** when possible  \n2. **Correct for multiplicity** (e.g., family-wise error or FDR) if reporting many subgroups  \n3. Emphasize **uncertainty** (wide CIs are expected)  \n4. Treat causal forest findings as **exploratory** unless prespecified or replicated  \n5. Always present the **overall ATE** alongside any heterogeneity results  \n\n---\n\n## 12. Example: Combining TMLE and Causal Forests\n\n```{r}\n# Step 1: ATE with TMLE\nsl_lib <- c(\"SL.glm\", \"SL.ranger\", \"SL.mean\")\n\ntmle_ate <- tmle(\n  Y = Y,\n  A = A,\n  W = X,\n  family = \"binomial\",\n  Q.SL.library = sl_lib,\n  g.SL.library = sl_lib\n)\n\ntmle_ate$estimates$ATE\n\n# Step 2: CATEs with causal forest (already computed as tau_hat)\nsummary(tau_hat)\n```\n\n- TMLE gives a **population-level effect** (with solid identifiability and efficiency).\n- Causal forest gives **individual-level estimated CATEs** to explore how effects vary.\n\n---\n\n## 13. Summary\n\nIn this chapter, you learned:\n\n- How to define causal estimands for effect modification and CATEs  \n- How to estimate subgroup-specific effects via TMLE  \n- How TMLE can be extended to continuous moderators using projection / variable importance frameworks  \n- How causal forests provide flexible, ML-driven CATE estimates  \n- How to interpret heterogeneous effects carefully in real-world and regulatory contexts  \n\nEffect modification analysis is powerful but fragile. Combining **TMLE** for confirmatory, parameter-focused inference and **causal forests** for exploratory, data-adaptive heterogeneity learning often yields the most insightful and responsible use of HTE methods.\n\n```{r}\nsessionInfo()\n```\n"},"formats":{"html":{"identifier":{"display-name":"HTML","target-format":"html","base-format":"html"},"execute":{"fig-width":7,"fig-height":5,"fig-format":"retina","fig-dpi":96,"df-print":"default","error":false,"eval":true,"cache":null,"freeze":false,"echo":true,"output":true,"warning":true,"include":true,"keep-md":false,"keep-ipynb":false,"ipynb":null,"enabled":null,"daemon":null,"daemon-restart":false,"debug":false,"ipynb-filters":[],"ipynb-shell-interactivity":null,"plotly-connected":true,"engine":"knitr"},"render":{"keep-tex":false,"keep-typ":false,"keep-source":false,"keep-hidden":false,"prefer-html":false,"output-divs":true,"output-ext":"html","fig-align":"default","fig-pos":null,"fig-env":null,"code-fold":true,"code-overflow":"scroll","code-link":false,"code-line-numbers":false,"code-tools":false,"tbl-colwidths":"auto","merge-includes":true,"inline-includes":false,"preserve-yaml":false,"latex-auto-mk":true,"latex-auto-install":true,"latex-clean":true,"latex-min-runs":1,"latex-max-runs":10,"latex-makeindex":"makeindex","latex-makeindex-opts":[],"latex-tlmgr-opts":[],"latex-input-paths":[],"latex-output-dir":null,"link-external-icon":false,"link-external-newwindow":false,"self-contained-math":false,"format-resources":[],"notebook-links":true},"pandoc":{"standalone":true,"wrap":"none","default-image-extension":"png","to":"html","toc":true,"output-file":"03-04-effect-modification.html"},"language":{"toc-title-document":"Table of contents","toc-title-website":"On this page","related-formats-title":"Other Formats","related-notebooks-title":"Notebooks","source-notebooks-prefix":"Source","other-links-title":"Other Links","code-links-title":"Code Links","launch-dev-container-title":"Launch Dev Container","launch-binder-title":"Launch Binder","article-notebook-label":"Article Notebook","notebook-preview-download":"Download Notebook","notebook-preview-download-src":"Download Source","notebook-preview-back":"Back to Article","manuscript-meca-bundle":"MECA Bundle","section-title-abstract":"Abstract","section-title-appendices":"Appendices","section-title-footnotes":"Footnotes","section-title-references":"References","section-title-reuse":"Reuse","section-title-copyright":"Copyright","section-title-citation":"Citation","appendix-attribution-cite-as":"For attribution, please cite this work as:","appendix-attribution-bibtex":"BibTeX citation:","appendix-view-license":"View License","title-block-author-single":"Author","title-block-author-plural":"Authors","title-block-affiliation-single":"Affiliation","title-block-affiliation-plural":"Affiliations","title-block-published":"Published","title-block-modified":"Modified","title-block-keywords":"Keywords","callout-tip-title":"Tip","callout-note-title":"Note","callout-warning-title":"Warning","callout-important-title":"Important","callout-caution-title":"Caution","code-summary":"Code","code-tools-menu-caption":"Code","code-tools-show-all-code":"Show All Code","code-tools-hide-all-code":"Hide All Code","code-tools-view-source":"View Source","code-tools-source-code":"Source Code","tools-share":"Share","tools-download":"Download","code-line":"Line","code-lines":"Lines","copy-button-tooltip":"Copy to Clipboard","copy-button-tooltip-success":"Copied!","repo-action-links-edit":"Edit this page","repo-action-links-source":"View source","repo-action-links-issue":"Report an issue","back-to-top":"Back to top","search-no-results-text":"No results","search-matching-documents-text":"matching documents","search-copy-link-title":"Copy link to search","search-hide-matches-text":"Hide additional matches","search-more-match-text":"more match in this document","search-more-matches-text":"more matches in this document","search-clear-button-title":"Clear","search-text-placeholder":"","search-detached-cancel-button-title":"Cancel","search-submit-button-title":"Submit","search-label":"Search","toggle-section":"Toggle section","toggle-sidebar":"Toggle sidebar navigation","toggle-dark-mode":"Toggle dark mode","toggle-reader-mode":"Toggle reader mode","toggle-navigation":"Toggle navigation","crossref-fig-title":"Figure","crossref-tbl-title":"Table","crossref-lst-title":"Listing","crossref-thm-title":"Theorem","crossref-lem-title":"Lemma","crossref-cor-title":"Corollary","crossref-prp-title":"Proposition","crossref-cnj-title":"Conjecture","crossref-def-title":"Definition","crossref-exm-title":"Example","crossref-exr-title":"Exercise","crossref-ch-prefix":"Chapter","crossref-apx-prefix":"Appendix","crossref-sec-prefix":"Section","crossref-eq-prefix":"Equation","crossref-lof-title":"List of Figures","crossref-lot-title":"List of Tables","crossref-lol-title":"List of Listings","environment-proof-title":"Proof","environment-remark-title":"Remark","environment-solution-title":"Solution","listing-page-order-by":"Order By","listing-page-order-by-default":"Default","listing-page-order-by-date-asc":"Oldest","listing-page-order-by-date-desc":"Newest","listing-page-order-by-number-desc":"High to Low","listing-page-order-by-number-asc":"Low to High","listing-page-field-date":"Date","listing-page-field-title":"Title","listing-page-field-description":"Description","listing-page-field-author":"Author","listing-page-field-filename":"File Name","listing-page-field-filemodified":"Modified","listing-page-field-subtitle":"Subtitle","listing-page-field-readingtime":"Reading Time","listing-page-field-wordcount":"Word Count","listing-page-field-categories":"Categories","listing-page-minutes-compact":"{0} min","listing-page-category-all":"All","listing-page-no-matches":"No matching items","listing-page-words":"{0} words","listing-page-filter":"Filter","draft":"Draft"},"metadata":{"lang":"en","fig-responsive":true,"quarto-version":"1.6.42","theme":"cosmo","smooth-scroll":true,"title":"Chapter 3.4: Effect Modification and Heterogeneous Treatment Effects","sidebar":{"style":"docked","search":true,"contents":[{"text":"Overview","href":"index.qmd"},{"section":"Advanced topics","contents":[{"text":"1.1 Regression vs Causal Inference","href":"01-01-regression-vs-causal.qmd"},{"text":"1.2 The Causal Roadmap in detail","href":"01-02-causal-roadmap.qmd"},{"text":"1.3 Identification and Estimands","href":"01-03-identification-estimands.qmd"},{"text":"2.1 G-computation","href":"02-01-gcomputation.qmd"},{"text":"2.2 Inverse Probability of Treatment Weighting (IPTW)","href":"02-02-iptw.qmd"},{"text":"2.3 Doubly Robust Estimation and Targeted Maximum Likelihood Estimation (TMLE)","href":"02-03-doubly-robust-tmle.qmd"},{"text":"2.4 Super Learner","href":"02-04-superlearner.qmd"},{"text":"3.3 Longitudinal Case Study","href":"03-03-longitudinal-case-study.qmd"},{"text":"3.4 Effect Modification","href":"03-04-effect-modification.qmd"},{"text":"3.5 Advanced Diagnostics","href":"03-05-advanced-diagnostics.qmd"},{"text":"3.6 RWD meets RCT: Hybrid Designs","href":"03-06-rwd-meets-rct-hybrid-designs.qmd"},{"text":"3.7 Longitudinal Time-Dependent Confounding","href":"03-07-longitudinal-td-confounding.qmd"},{"text":"3.8 TMLE in the Clean Room Design","href":"03-08-tmle-clean-room.qmd"},{"text":"Covariate Adjustment IN RCTs using TMLE","href":"chapter_covariate_adjustment_tmle.qmd"},{"text":"Common Pitfalls in Causal Inference","href":"common-pitfalls.qmd"}]}]}},"extensions":{"book":{"multiFile":true}}}},"projectFormats":["html"]}