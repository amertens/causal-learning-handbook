{
  "hash": "fc8ee8d16fdd6dbbbc30cbd6fae3edc8",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Chapter 3.6: When RWD Meets RCT – Hybrid Designs\"\nformat: html\n---\n\n\n\n\n# Chapter 3.6  \n## When RWD Meets RCT – Hybrid Designs for Causal Inference  \n*Combining randomized and observational data to improve precision and generalizability*\n\nRandomized controlled trials (RCTs) are the gold standard for causal inference.  \nBut they are:\n\n- Expensive and slow  \n- Often underpowered for rare events and subgroup effects  \n- Conducted in selective populations  \n- Not always feasible or ethical  \n\nReal-world data (RWD) — registries, EHR, claims — provide:\n\n- Large, diverse populations  \n- Naturalistic treatment patterns  \n- Long-term safety follow-up  \n\n**Hybrid RCT–RWD designs** aim to combine:\n\n- The *internal validity* of RCTs  \n- The *external validity* and scale of RWD  \n\nThis chapter introduces:\n\n1. Why hybrid designs are needed  \n2. Types of hybrid designs with external controls  \n3. Transportability and generalizability concepts  \n4. ES-CV-TMLE (External Supervised Cross-Validated TMLE)  \n5. A-TMLE (Adaptive TMLE) for integrating multiple data sources  \n6. Practical considerations and diagnostics  \n\n---\n\n## 1. Why Combine RCT and RWD?\n\n### 1.1 Precision\n\nTrials may be underpowered for:\n\n- Rare safety endpoints  \n- Important subgroups  \n- Long-term secondary endpoints  \n\nExternal RWD can add information and boost precision without enrolling more randomized patients.\n\n### 1.2 Generalizability\n\nRCT participants tend to:\n\n- Be younger and healthier  \n- Have fewer comorbidities  \n- Be more adherent and monitored  \n\nThus, trial results may not fully apply to routine-care populations.\n\n### 1.3 Feasibility and ethics\n\nHybrid designs are useful when:\n\n- Placebo or standard randomized controls are unethical  \n- Only a single-arm trial is feasible  \n- Rapid evidence is needed (e.g., post-marketing surveillance, rare diseases)\n\n---\n\n## 2. Basic Hybrid Designs\n\nSeveral design patterns are commonly used.\n\n---\n\n### 2.1 External Control Arms\n\nA **single-arm trial** (all patients get experimental treatment) may be compared against an **external control** arm from RWD.\n\nUse cases:\n\n- Oncology (historical controls)  \n- Rare diseases  \n- When standard-of-care is well characterized\n\nChallenges:\n\n- Confounding by indication  \n- Differences in data capture, follow-up, eligibility  \n- Timing effects (calendar time, coding changes)  \n\n---\n\n### 2.2 Augmented Control Arms\n\nAn RCT randomizes patients to:\n\n- Experimental treatment vs trial control (e.g., 2:1 randomization)  \n\nBut the trial control arm is **augmented** with external RWD controls to:\n\n- Improve precision  \n- Reduce required randomized control sample size  \n- Support safety and rare-event evaluation  \n\nBorrowing can be:\n\n- Fixed (pre-specified)  \n- Dynamic / adaptive (data-driven)  \n\n---\n\n### 2.3 Transportability and Generalizability\n\nYou may have:\n\n- An RCT effect estimate in a selected population  \n- A target population in RWD  \n\nGoal:\n\n> *Transport* or *generalize* the trial effect to the RWD population.\n\nRequires:\n\n- Modeling the difference between trial and target populations  \n- Adjusting for “sampling bias” (who joins the trial)\n\nTechniques:\n\n- Inverse odds of sampling weights (IOSW)  \n- Transport / generalizability TMLE  \n- Doubly robust methods combining outcome and sampling models  \n\n---\n\n## 3. Identification: Assumptions in Hybrid Settings\n\nBeyond usual RCT assumptions, hybrid designs require:\n\n### 3.1 No unmeasured confounding (for external / observational arms)\n\nWithin the external data:\n\n- Treatment–outcome confounding must be controlled using available covariates  \n- Residual confounding may bias the hybrid estimate\n\n### 3.2 Common support (overlap)\n\nThe joint covariate space of:\n\n- RCT participants  \n- RWD patients  \n\nmust overlap, especially when:\n\n- Using RWD to estimate control outcomes  \n- Transporting effects across populations\n\n### 3.3 Consistency across sources\n\nMedical coding, endpoint definitions, and measurement schemes should be compatible (or harmonized).\n\n---\n\n## 4. ES-CV-TMLE: External Supervised Cross-Validated TMLE\n\n**ES-CV-TMLE (External Supervised Cross-Validated TMLE)** is a targeted learning approach that:\n\n- Uses **external data (RWD)** to help train nuisance models (e.g., outcome regressions)  \n- Validates and selects among them using **cross-validation in the RCT only**  \n- Ensures external data do not degrade the validity of RCT-based estimation  \n\n### 4.1 Key idea\n\nWe may have poor precision in the RCT alone for nuisance functions \\(Q\\) and \\(g\\).  \nExternal data can improve the *learning* of these functions, but confounding in the RWD could distort:\n\n- Outcome relationships  \n- Treatment assignment mechanisms  \n\nES-CV-TMLE protects against this by:\n\n1. Proposing multiple candidate nuisance models, some learned on:\n   - RCT only  \n   - RWD only  \n   - Combined data  \n\n2. Using **cross-validation on the RCT** to evaluate each model’s performance (e.g., via log-likelihood loss).  \n3. Choosing the best-performing nuisance model (or an ensemble of them) for TMLE.\n\nExternal data are “supervisors” but do not override the RCT.\n\n### 4.2 Conceptual algorithm\n\n1. Pool RCT and RWD data for training candidate models:\n   - \\(Q_{\text{RCT}}\\): trained only on RCT  \n   - \\(Q_{\text{RWD}}\\): trained only on RWD  \n   - \\(Q_{\text{pool}}\\): trained on combined RCT+RWD  \n\n2. For each candidate Q-model:\n   - Use RCT data only  \n   - Run cross-validated evaluation (e.g., deviance, negative log-likelihood)  \n\n3. Select (or weight) candidate Qs via SuperLearner-style metalearning.  \n\n4. Use the chosen Q (and similarly chosen g, if desired) in TMLE on the RCT data.\n\nThis preserves the RCT-based identification and uses RWD as an auxiliary data source for better prediction.\n\n---\n\n## 5. A-TMLE: Adaptive Targeted Maximum Likelihood Estimation\n\n**Adaptive TMLE (A-TMLE)** generalizes ES-CV-TMLE to the estimator level.\n\nInstead of combining candidate **nuisance models**, A-TMLE combines candidate **estimators** (e.g., separate hybrid analyses):\n\n- TMLE using RCT only  \n- TMLE using RWD only (carefully adjusted)  \n- TMLE using both RCT + RWD in a joint model  \n- Other candidate estimators\n\nIt then uses a SuperLearner-style convex combination of these estimators to:\n\n> Minimize cross-validated risk, yielding an adaptive, doubly robust final estimate.\n\n### 5.1 Why A-TMLE?\n\nMultiple data sources can provide:\n\n- High internal validity (RCT)  \n- High external validity (RWD)  \n- Different types of bias and variance  \n\nA-TMLE lets the data decide the optimal combination, subject to:\n\n- Constraints (e.g., RCT estimator always included)  \n- Hierarchical preferences (e.g., more weight on RCT when conflict arises)\n\n### 5.2 Mathematical structure\n\nLet \\( \\hat\\Psi_1, \\dots, \\hat\\Psi_K\\) be candidate estimators of the same target parameter \\(\\Psi\\).\n\nA-TMLE constructs:\n\n\\[\n\\hat\\Psi_{\text{A-TMLE}} = \\sum_{k=1}^K \u0007lpha_k \\hat\\Psi_k\n\\]\n\nwith\n\n- \\(\u0007lpha_k \\ge 0\\)  \n- \\(\\sum_k \u0007lpha_k = 1\\)\n\nWeights \\(\u0007lpha\\) are chosen to minimize cross-validated loss (e.g., squared error of influence curves).\n\n---\n\n## 6. Example Hybrid Workflow (Conceptual)\n\nConsider:\n\n- RCT: experimental vs placebo  \n- RWD: observational comparison between experimental drug and standard-of-care  \n\n### 6.1 TMLE using RCT only\n\n```r\ntmle_rct <- tmle(\n  Y = Y_rct,\n  A = A_rct,\n  W = W_rct,\n  family = \"binomial\",\n  Q.SL.library = c(\"SL.glm\", \"SL.ranger\"),\n  g.SL.library = c(\"SL.glm\", \"SL.ranger\")\n)\npsi_rct <- tmle_rct$estimates$ATE$psi\n```\n\n### 6.2 TMLE using RWD (careful confounding control)\n\n```r\ntmle_rwd <- tmle(\n  Y = Y_rwd,\n  A = A_rwd,\n  W = W_rwd,\n  family = \"binomial\",\n  Q.SL.library = c(\"SL.glm\", \"SL.ranger\"),\n  g.SL.library = c(\"SL.glm\", \"SL.ranger\")\n)\npsi_rwd <- tmle_rwd$estimates$ATE$psi\n```\n\n### 6.3 Pooled-source TMLE\n\n```r\nY_pool <- c(Y_rct, Y_rwd)\nA_pool <- c(A_rct, A_rwd)\nW_pool <- rbind(W_rct, W_rwd)\n\ntmle_pool <- tmle(\n  Y = Y_pool,\n  A = A_pool,\n  W = W_pool,\n  family = \"binomial\",\n  Q.SL.library = c(\"SL.glm\", \"SL.ranger\"),\n  g.SL.library = c(\"SL.glm\", \"SL.ranger\")\n)\npsi_pool <- tmle_pool$estimates$ATE$psi\n```\n\n### 6.4 Adaptive combination (A-TMLE style idea)\n\n```r\ncandidates <- c(psi_rct, psi_rwd, psi_pool)\n\n# Placeholder: in practice, you would build a loss function based on influence curves\n# and use constrained optimization (e.g., nnls) with cross-validation to find weights.\n\nweights <- c(0.6, 0.0, 0.4)  # e.g., chosen by cross-validation\nweights <- weights / sum(weights)\n\npsi_atmle <- sum(weights * candidates)\npsi_atmle\n```\n\nIn a true A-TMLE implementation, the weights would be:\n\n- Estimated based on CV risk  \n- Possibly constrained to ensure heavier emphasis on RCT-based estimators  \n\n---\n\n## 7. Practical Considerations and Diagnostics for Hybrid Designs\n\n### 7.1 Harmonization\n\nBefore attempting hybrid estimation:\n\n- Align endpoint definitions and censoring rules  \n- Harmonize covariates (coding, units, ranges)  \n- Confirm consistent definition of “treatment” across sources  \n\n### 7.2 Assess similarity between RCT and RWD\n\nCheck covariate distributions:\n\n```r\nbind_rows(\n  W_rct %>% mutate(source = \"RCT\"),\n  W_rwd %>% mutate(source = \"RWD\")\n) %>%\n  pivot_longer(cols = -source) %>%\n  ggplot(aes(x = value, fill = source)) +\n  geom_density(alpha = 0.4) +\n  facet_wrap(~ name, scales = \"free\")\n```\n\nLook for:\n\n- Large discrepancies → may require transportability modeling  \n- Non-overlapping regions → positivity issues  \n\n### 7.3 Sensitivity analyses\n\n- Re-estimate using RCT-only TMLE  \n- Vary the degree of borrowing (e.g., by up-weighting/down-weighting RWD in hybrid estimators)  \n- Use E-values or QBA to examine impact of unmeasured confounding in RWD component  \n- Apply negative control analyses in the RWD part  \n\n---\n\n## 8. When to Use Hybrid Designs (and When Not To)\n\nHybrid designs are **appropriate** when:\n\n- RWD is of reasonable quality  \n- Key confounders in RWD are measured  \n- Outcome definitions are compatible  \n- There is substantial overlap in covariate distributions  \n- The trial alone is underpowered or narrow in scope  \n\nThey may be **inappropriate** when:\n\n- RWD is subject to severe unmeasured confounding  \n- Data sources are poorly harmonized  \n- There is little overlap in covariate or treatment patterns  \n\nIn those cases, a pure RCT analysis with careful interpretation may be preferable.\n\n---\n\n## 9. Summary\n\nHybrid RCT–RWD designs extend the causal roadmap to a richer evidence ecosystem:\n\n- **External controls** can augment sparse trial control arms  \n- **Transport and generalizability methods** can extend findings to broader populations  \n- **ES-CV-TMLE** leverages RWD for nuisance modeling while preserving internal validity  \n- **A-TMLE** adaptively combines estimators from multiple sources using targeted learning and cross-validation  \n\nUsed carefully, these tools can:\n\n- Improve precision  \n- Enhance generalizability  \n- Provide robust, transparent evidence that respects the strengths and limitations of both RCT and RWD  \n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsessionInfo()\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nR version 4.4.2 (2024-10-31 ucrt)\nPlatform: x86_64-w64-mingw32/x64\nRunning under: Windows 11 x64 (build 26200)\n\nMatrix products: default\n\n\nlocale:\n[1] LC_COLLATE=English_United States.utf8 \n[2] LC_CTYPE=English_United States.utf8   \n[3] LC_MONETARY=English_United States.utf8\n[4] LC_NUMERIC=C                          \n[5] LC_TIME=English_United States.utf8    \n\ntime zone: America/Los_Angeles\ntzcode source: internal\n\nattached base packages:\n[1] stats     graphics  grDevices utils     datasets  methods   base     \n\nloaded via a namespace (and not attached):\n [1] htmlwidgets_1.6.4 compiler_4.4.2    fastmap_1.2.0     cli_3.6.5        \n [5] tools_4.4.2       htmltools_0.5.8.1 rstudioapi_0.17.1 yaml_2.3.10      \n [9] rmarkdown_2.29    knitr_1.49        jsonlite_2.0.0    xfun_0.49        \n[13] digest_0.6.37     rlang_1.1.6       evaluate_1.0.5   \n```\n\n\n:::\n:::\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}