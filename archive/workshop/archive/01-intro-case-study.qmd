---
title: "1. Introduction & Case Study: Post-Market Safety of Prolia"
format:
  html:
    toc: true
    toc-depth: 3
---

# Background

This lesson introduces our motivating example: evaluating the post-market cardiovascular safety of **denosumab (Prolia)** compared to **zoledronic acid**.

We'll use this as our running example throughout the workshop to illustrate the Causal Roadmap.

![Placeholder: Conceptual diagram of study design (Prolia vs. ZA).](../images/prolia_design_placeholder.png)
*Figure 1. Study schematic for the Prolia vs. Zoledronic Acid cardiovascular safety study.*


```{r, cache=TRUE, eval=FALSE}

#romain's EHR simulation package

remotes::install_github("romainkp/LtAtStructuR")
library(LtAtStructuR)
library(data.table)
library(lubridate)
library(future) # optional (for parallel processing)
#plan(multiprocess) # optional (for parallel processing)

## Define one cohort dataset, one exposure dataset, and one or more covariate
## datasets
cohort <- setCohort(cohortDT, "ID", "IndexDate", "EOFDate", "EOFtype",
                    "AMI", c("ageEntry", "sex", "race", "A1c", "eGFR"),
                    list("ageEntry"=list("categorical"=FALSE,
                                        "impute"=NA,
                                        "impute_default_level"=NA),
                        "sex"=list("categorical"=TRUE,
                                   "impute"=NA,
                                   "impute_default_level"=NA),
                        "race"=list("categorical"=TRUE,
                                    "impute"=NA,
                                    "impute_default_level"=NA)) )
exposure <- setExposure(expDT, "ID", "startA", "endA")
covariate1 <- setCovariate(a1cDT, "sporadic", "ID", "A1cDate", "A1c",
                           categorical = FALSE)
covariate2 <- setCovariate(egfrDT, "sporadic", "ID", "eGFRDate", "eGFR",
                           categorical = TRUE)

## Gather each input dataset into a single object that specifies the content of
## the output dataset to be constructed
LtAt.specification <- cohort + exposure + covariate1 + covariate2

## Construct the output dataset
LtAt.data <- construct(LtAt.specification, time_unit = 15, first_exp_rule = 1,
                       exp_threshold = 0.75)
head(LtAt.data)

```

