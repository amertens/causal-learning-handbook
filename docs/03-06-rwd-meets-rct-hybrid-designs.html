<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.42">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="description" content="A practical guide to the Causal Roadmap, Targeted Maximum Likelihood Estimation (TMLE), and Super Learner for modern causal inference in epidemiology, with emphasis on pharmacoepidemiology and clinical trial analysis.">

<title>14&nbsp; Chapter 3.6: When RWD Meets RCT – Hybrid Designs – Causal Learning Handbook</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./03-07-longitudinal-td-confounding.html" rel="next">
<link href="./03-05-advanced-diagnostics.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-2f5df379a58b258e96c21c0638c20c03.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-b343bb23504f009ddf7b24643a6af19a.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="style.css">
</head>

<body class="nav-sidebar docked">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./03-03-longitudinal-case-study.html">Part III: Advanced Topics</a></li><li class="breadcrumb-item"><a href="./03-06-rwd-meets-rct-hybrid-designs.html"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Chapter 3.6: When RWD Meets RCT – Hybrid Designs</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation docked overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Causal Learning Handbook</a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com/amertens/causal-learning-handbook" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Causal Learning Handbook</span></span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">Part I: Foundations</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./01-01-regression-vs-causal.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Chapter 1.1: Limitations of Standard Regression Analyses</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./01-02-causal-roadmap.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Chapter 1.2: The Causal Roadmap</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./01-03-identification-estimands.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Chapter 1.3: From Causal Questions to Analysis — Identification, Estimands, and Statistical Models</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./roadmap_tutorial.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Causal Roadmap for Real-world Evidence Generation: A Tutorial</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true">
 <span class="menu-text">Part II: Estimation Methods</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./02-01-gcomputation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Chapter 2.1: Outcome Modeling and Standardization (G-Computation)</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./02-02-iptw.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Chapter 2.2: Inverse Probability of Treatment Weighting (IPTW)</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./02-03-doubly-robust-tmle.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Chapter 2.3: Doubly Robust Estimators and Targeted Learning (AIPW + TMLE)</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./02-04-tmle-teaching-examples.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Chapter 2.4: From Question to Estimate — TMLE in Practice</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./superlearner.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Chapter 2.4: SuperLearner and Machine Learning for Causal Inference</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true">
 <span class="menu-text">Part III: Advanced Topics</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./03-03-longitudinal-case-study.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Chapter 3.3: Case Study – Real-World Application in Longitudinal Analysis</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./03-04-effect-modification.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Chapter 3.4: Effect Modification and Heterogeneous Treatment Effects</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./03-05-advanced-diagnostics.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Chapter 3.5: Advanced Diagnostics and Sensitivity Analyses</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./03-06-rwd-meets-rct-hybrid-designs.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Chapter 3.6: When RWD Meets RCT – Hybrid Designs</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./03-07-longitudinal-td-confounding.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Chapter 3.7: Imperfect Adherence, Time-Varying Confounding, and Longitudinal TMLE</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./03-08-tmle-clean-room.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Chapter 3.8: TMLE in the Clean-Room Framework for Pharmacoepidemiology</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./03-09-illustrated-ltmle.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">An Illustrated Guide to Longitudinal TMLE</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./03-10-tmle-mediation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">An Illustrated Guide to TMLE for Mediation Analysis</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true">
 <span class="menu-text">Appendices</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./common-pitfalls.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">19</span>&nbsp; <span class="chapter-title">Common Pitfalls and How to Avoid Them</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./anotated_bibliography.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">20</span>&nbsp; <span class="chapter-title">Annotated Bibliography: Modern Causal Inference and Targeted Learning</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./other_resources.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">21</span>&nbsp; <span class="chapter-title">Resources</span></span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#chapter-3.6" id="toc-chapter-3.6" class="nav-link active" data-scroll-target="#chapter-3.6"><span class="header-section-number">15</span> Chapter 3.6</a>
  <ul class="collapse">
  <li><a href="#when-rwd-meets-rct-hybrid-designs-for-causal-inference" id="toc-when-rwd-meets-rct-hybrid-designs-for-causal-inference" class="nav-link" data-scroll-target="#when-rwd-meets-rct-hybrid-designs-for-causal-inference"><span class="header-section-number">15.1</span> When RWD Meets RCT – Hybrid Designs for Causal Inference</a></li>
  <li><a href="#why-combine-rct-and-rwd" id="toc-why-combine-rct-and-rwd" class="nav-link" data-scroll-target="#why-combine-rct-and-rwd"><span class="header-section-number">15.2</span> 1. Why Combine RCT and RWD?</a></li>
  <li><a href="#basic-hybrid-designs" id="toc-basic-hybrid-designs" class="nav-link" data-scroll-target="#basic-hybrid-designs"><span class="header-section-number">15.3</span> 2. Basic Hybrid Designs</a></li>
  <li><a href="#identification-assumptions-in-hybrid-settings" id="toc-identification-assumptions-in-hybrid-settings" class="nav-link" data-scroll-target="#identification-assumptions-in-hybrid-settings"><span class="header-section-number">15.4</span> 3. Identification: Assumptions in Hybrid Settings</a></li>
  <li><a href="#es-cv-tmle-external-supervised-cross-validated-tmle" id="toc-es-cv-tmle-external-supervised-cross-validated-tmle" class="nav-link" data-scroll-target="#es-cv-tmle-external-supervised-cross-validated-tmle"><span class="header-section-number">15.5</span> 4. ES-CV-TMLE: External Supervised Cross-Validated TMLE</a></li>
  <li><a href="#a-tmle-adaptive-targeted-maximum-likelihood-estimation" id="toc-a-tmle-adaptive-targeted-maximum-likelihood-estimation" class="nav-link" data-scroll-target="#a-tmle-adaptive-targeted-maximum-likelihood-estimation"><span class="header-section-number">15.6</span> 5. A-TMLE: Adaptive Targeted Maximum Likelihood Estimation</a>
  <ul class="collapse">
  <li><a href="#why-a-tmle" id="toc-why-a-tmle" class="nav-link" data-scroll-target="#why-a-tmle"><span class="header-section-number">15.6.1</span> 5.1 Why A-TMLE?</a></li>
  <li><a href="#mathematical-structure" id="toc-mathematical-structure" class="nav-link" data-scroll-target="#mathematical-structure"><span class="header-section-number">15.6.2</span> 5.2 Mathematical structure</a></li>
  </ul></li>
  <li><a href="#example-hybrid-workflow-conceptual" id="toc-example-hybrid-workflow-conceptual" class="nav-link" data-scroll-target="#example-hybrid-workflow-conceptual"><span class="header-section-number">15.7</span> 6. Example Hybrid Workflow (Conceptual)</a>
  <ul class="collapse">
  <li><a href="#tmle-using-rct-only" id="toc-tmle-using-rct-only" class="nav-link" data-scroll-target="#tmle-using-rct-only"><span class="header-section-number">15.7.1</span> 6.1 TMLE using RCT only</a></li>
  <li><a href="#tmle-using-rwd-careful-confounding-control" id="toc-tmle-using-rwd-careful-confounding-control" class="nav-link" data-scroll-target="#tmle-using-rwd-careful-confounding-control"><span class="header-section-number">15.7.2</span> 6.2 TMLE using RWD (careful confounding control)</a></li>
  <li><a href="#pooled-source-tmle" id="toc-pooled-source-tmle" class="nav-link" data-scroll-target="#pooled-source-tmle"><span class="header-section-number">15.7.3</span> 6.3 Pooled-source TMLE</a></li>
  <li><a href="#adaptive-combination-a-tmle-style-idea" id="toc-adaptive-combination-a-tmle-style-idea" class="nav-link" data-scroll-target="#adaptive-combination-a-tmle-style-idea"><span class="header-section-number">15.7.4</span> 6.4 Adaptive combination (A-TMLE style idea)</a></li>
  </ul></li>
  <li><a href="#practical-considerations-and-diagnostics-for-hybrid-designs" id="toc-practical-considerations-and-diagnostics-for-hybrid-designs" class="nav-link" data-scroll-target="#practical-considerations-and-diagnostics-for-hybrid-designs"><span class="header-section-number">15.8</span> 7. Practical Considerations and Diagnostics for Hybrid Designs</a></li>
  <li><a href="#when-to-use-hybrid-designs-and-when-not-to" id="toc-when-to-use-hybrid-designs-and-when-not-to" class="nav-link" data-scroll-target="#when-to-use-hybrid-designs-and-when-not-to"><span class="header-section-number">15.9</span> 8. When to Use Hybrid Designs (and When Not To)</a></li>
  <li><a href="#summary" id="toc-summary" class="nav-link" data-scroll-target="#summary"><span class="header-section-number">15.10</span> 9. Summary</a></li>
  <li><a href="#software-implementation-r" id="toc-software-implementation-r" class="nav-link" data-scroll-target="#software-implementation-r"><span class="header-section-number">15.11</span> Software Implementation (R)</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./03-03-longitudinal-case-study.html">Part III: Advanced Topics</a></li><li class="breadcrumb-item"><a href="./03-06-rwd-meets-rct-hybrid-designs.html"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Chapter 3.6: When RWD Meets RCT – Hybrid Designs</span></a></li></ol></nav>
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Chapter 3.6: When RWD Meets RCT – Hybrid Designs</span></h1><button type="button" class="btn code-tools-button" id="quarto-code-tools-source"><i class="bi"></i> Code</button></div></div>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="chapter-3.6" class="level1" data-number="15">
<h1 data-number="15"><span class="header-section-number">15</span> Chapter 3.6</h1>
<section id="when-rwd-meets-rct-hybrid-designs-for-causal-inference" class="level2" data-number="15.1">
<h2 data-number="15.1" class="anchored" data-anchor-id="when-rwd-meets-rct-hybrid-designs-for-causal-inference"><span class="header-section-number">15.1</span> When RWD Meets RCT – Hybrid Designs for Causal Inference</h2>
<p><em>Combining randomized and observational data to improve precision and generalizability</em></p>
<p>Randomized controlled trials (RCTs) are the gold standard for causal inference.<br>
But they are:</p>
<ul>
<li>Expensive and slow<br>
</li>
<li>Often underpowered for rare events and subgroup effects<br>
</li>
<li>Conducted in selective populations<br>
</li>
<li>Not always feasible or ethical</li>
</ul>
<p>Real-world data (RWD) — registries, EHR, claims — provide:</p>
<ul>
<li>Large, diverse populations<br>
</li>
<li>Naturalistic treatment patterns<br>
</li>
<li>Long-term safety follow-up</li>
</ul>
<p><strong>Hybrid RCT–RWD designs</strong> aim to combine:</p>
<ul>
<li>The <em>internal validity</em> of RCTs<br>
</li>
<li>The <em>external validity</em> and scale of RWD</li>
</ul>
<p>This chapter introduces:</p>
<ol type="1">
<li>Why hybrid designs are needed<br>
</li>
<li>Types of hybrid designs with external controls<br>
</li>
<li>Transportability and generalizability concepts<br>
</li>
<li>ES-CV-TMLE (External Supervised Cross-Validated TMLE)<br>
</li>
<li>A-TMLE (Adaptive TMLE) for integrating multiple data sources<br>
</li>
<li>Practical considerations and diagnostics</li>
</ol>
<hr>
</section>
<section id="why-combine-rct-and-rwd" class="level2" data-number="15.2">
<h2 data-number="15.2" class="anchored" data-anchor-id="why-combine-rct-and-rwd"><span class="header-section-number">15.2</span> 1. Why Combine RCT and RWD?</h2>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Three Key Motivations for Hybrid RCT-RWD Designs
</div>
</div>
<div class="callout-body-container callout-body">
<p>As epidemiologists, we know that no single data source is perfect. RCTs give us internal validity but are often too small, too narrow, or too slow. RWD gives us scale and diversity but lacks randomization. Hybrid designs try to get the best of both worlds. There are three core reasons to combine them:</p>
<section id="precision" class="level3" data-number="15.2.1">
<h3 data-number="15.2.1" class="anchored" data-anchor-id="precision"><span class="header-section-number">15.2.1</span> 1.1 Precision</h3>
<p>Trials may be underpowered for:</p>
<ul>
<li>Rare safety endpoints</li>
<li>Important subgroups</li>
<li>Long-term secondary endpoints</li>
</ul>
<p>External RWD can add information and boost precision without enrolling more randomized patients.</p>
</section>
<section id="generalizability" class="level3" data-number="15.2.2">
<h3 data-number="15.2.2" class="anchored" data-anchor-id="generalizability"><span class="header-section-number">15.2.2</span> 1.2 Generalizability</h3>
<p>RCT participants tend to:</p>
<ul>
<li>Be younger and healthier</li>
<li>Have fewer comorbidities</li>
<li>Be more adherent and monitored</li>
</ul>
<p>Thus, trial results may not fully apply to routine-care populations. Think of the typical phase III oncology trial – the enrolled patients are often younger and have better performance status than those you would see in a community oncology clinic.</p>
</section>
<section id="feasibility-and-ethics" class="level3" data-number="15.2.3">
<h3 data-number="15.2.3" class="anchored" data-anchor-id="feasibility-and-ethics"><span class="header-section-number">15.2.3</span> 1.3 Feasibility and ethics</h3>
<p>Hybrid designs are useful when:</p>
<ul>
<li>Placebo or standard randomized controls are unethical</li>
<li>Only a single-arm trial is feasible</li>
<li>Rapid evidence is needed (e.g., post-marketing surveillance, rare diseases)</li>
</ul>
</section>
</div>
</div>
<hr>
</section>
<section id="basic-hybrid-designs" class="level2" data-number="15.3">
<h2 data-number="15.3" class="anchored" data-anchor-id="basic-hybrid-designs"><span class="header-section-number">15.3</span> 2. Basic Hybrid Designs</h2>
<p>Several design patterns are commonly used.</p>
<hr>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
External Control Arms
</div>
</div>
<div class="callout-body-container callout-body">
<p>In plain language, an <strong>external control arm</strong> means: instead of randomizing some patients to a control group within your trial, you borrow the control group from outside the trial – typically from a registry, EHR database, or historical trial data.</p>
<p>A <strong>single-arm trial</strong> (all patients get experimental treatment) may be compared against an <strong>external control</strong> arm from RWD.</p>
<p>Use cases:</p>
<ul>
<li>Oncology (historical controls)</li>
<li>Rare diseases</li>
<li>When standard-of-care is well characterized</li>
</ul>
</div>
</div>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Challenges of External Controls
</div>
</div>
<div class="callout-body-container callout-body">
<p>External controls introduce serious methodological risks that every epidemiologist should scrutinize:</p>
<ul>
<li><strong>Confounding by indication</strong>: Patients in the RWD were not randomized. The reasons they received (or did not receive) a treatment are entangled with their prognosis.</li>
<li><strong>Differences in data capture</strong>: The trial measures outcomes with protocol-specified visits, imaging schedules, and adjudication committees. The RWD may rely on billing codes, free-text notes, or inconsistent follow-up.</li>
<li><strong>Eligibility misalignment</strong>: Trial patients passed strict inclusion/exclusion criteria. RWD patients may differ systematically.</li>
<li><strong>Calendar time and secular trends</strong>: Changes in supportive care, diagnostic coding (e.g., ICD-9 to ICD-10 transitions), or standard-of-care over time can create spurious differences.</li>
</ul>
<p>Always ask: “Would the external controls have been eligible for the trial, and are their outcomes measured comparably?”</p>
</div>
</div>
<hr>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Augmented Control Arms
</div>
</div>
<div class="callout-body-container callout-body">
<p>Unlike a fully external control, an <strong>augmented control arm</strong> retains randomization within the trial – you still have a concurrent randomized control group. The external RWD supplements it rather than replacing it entirely. Think of it as “topping up” your control arm with additional data.</p>
<p>An RCT randomizes patients to:</p>
<ul>
<li>Experimental treatment vs trial control (e.g., 2:1 randomization)</li>
</ul>
<p>But the trial control arm is <strong>augmented</strong> with external RWD controls to:</p>
<ul>
<li>Improve precision</li>
<li>Reduce required randomized control sample size</li>
<li>Support safety and rare-event evaluation</li>
</ul>
<p>Borrowing can be:</p>
<ul>
<li><strong>Fixed (pre-specified)</strong>: You decide before unblinding how much external data to incorporate.</li>
<li><strong>Dynamic / adaptive (data-driven)</strong>: The degree of borrowing depends on how similar the RWD control outcomes are to the trial control outcomes (e.g., power prior, commensurate prior approaches).</li>
</ul>
<p>This is generally safer than a pure external control design because the concurrent randomized control arm serves as a built-in validity check.</p>
</div>
</div>
<hr>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Transportability and Generalizability
</div>
</div>
<div class="callout-body-container callout-body">
<p><strong>In plain language</strong>: “Transporting” a trial result means taking the causal effect estimated in the trial’s selected population and asking, “What would this effect be in a different, broader population?” For example, if a trial enrolled mostly younger patients with good kidney function, transportability methods let you estimate what the treatment effect would be in the full population of Medicare beneficiaries – including older, sicker patients who were excluded from the trial.</p>
<ul>
<li><strong>Generalizability</strong> = extending results from the trial sample to the full population the trial was sampled from.</li>
<li><strong>Transportability</strong> = extending results to an entirely different target population.</li>
</ul>
<p>You may have:</p>
<ul>
<li>An RCT effect estimate in a selected population</li>
<li>A target population in RWD</li>
</ul>
<p>Goal:</p>
<blockquote class="blockquote">
<p><em>Transport</em> or <em>generalize</em> the trial effect to the RWD population.</p>
</blockquote>
<p>Requires:</p>
<ul>
<li>Modeling the difference between trial and target populations</li>
<li>Adjusting for “sampling bias” (who joins the trial)</li>
</ul>
<p>Techniques:</p>
<ul>
<li>Inverse odds of sampling weights (IOSW)</li>
<li>Transport / generalizability TMLE</li>
<li>Doubly robust methods combining outcome and sampling models</li>
</ul>
</div>
</div>
<hr>
</section>
<section id="identification-assumptions-in-hybrid-settings" class="level2" data-number="15.4">
<h2 data-number="15.4" class="anchored" data-anchor-id="identification-assumptions-in-hybrid-settings"><span class="header-section-number">15.4</span> 3. Identification: Assumptions in Hybrid Settings</h2>
<p>Beyond usual RCT assumptions, hybrid designs require:</p>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Assumption 3.1: No Unmeasured Confounding (for External / Observational Arms)
</div>
</div>
<div class="callout-body-container callout-body">
<p>Within the external data:</p>
<ul>
<li>Treatment-outcome confounding must be controlled using available covariates</li>
<li>Residual confounding may bias the hybrid estimate</li>
</ul>
<p>In epi terms, this is the same exchangeability assumption you are familiar with from observational studies – but now it applies specifically to the RWD component of your hybrid design. The RCT component is protected by randomization; the RWD component is not.</p>
</div>
</div>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Assumption 3.2: Common Support (Overlap)
</div>
</div>
<div class="callout-body-container callout-body">
<p>The joint covariate space of:</p>
<ul>
<li>RCT participants</li>
<li>RWD patients</li>
</ul>
<p>must overlap, especially when:</p>
<ul>
<li>Using RWD to estimate control outcomes</li>
<li>Transporting effects across populations</li>
</ul>
<p>This is the positivity assumption applied across data sources. If trial participants are systematically different from RWD patients in ways that matter for the outcome, you cannot borrow information reliably. Check covariate distributions carefully before proceeding.</p>
</div>
</div>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Assumption 3.3: Consistency Across Sources
</div>
</div>
<div class="callout-body-container callout-body">
<p>Medical coding, endpoint definitions, and measurement schemes should be compatible (or harmonized).</p>
<p>For example, “progression-free survival” measured by central radiology review in a trial is not the same as “progression-free survival” inferred from claims data or chart review. If outcome definitions differ between the RCT and RWD, the hybrid estimator conflates apples and oranges.</p>
</div>
</div>
<hr>
</section>
<section id="es-cv-tmle-external-supervised-cross-validated-tmle" class="level2" data-number="15.5">
<h2 data-number="15.5" class="anchored" data-anchor-id="es-cv-tmle-external-supervised-cross-validated-tmle"><span class="header-section-number">15.5</span> 4. ES-CV-TMLE: External Supervised Cross-Validated TMLE</h2>
<p><strong>ES-CV-TMLE (External Supervised Cross-Validated TMLE)</strong> is a targeted learning approach that:</p>
<ul>
<li>Uses <strong>external data (RWD)</strong> to help train nuisance models (e.g., outcome regressions)<br>
</li>
<li>Validates and selects among them using <strong>cross-validation in the RCT only</strong><br>
</li>
<li>Ensures external data do not degrade the validity of RCT-based estimation</li>
</ul>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
ES-CV-TMLE: The Core Insight
</div>
</div>
<div class="callout-body-container callout-body">
<p>Here is the key idea in plain language: <strong>External data help you train better prediction models, but the RCT is the judge.</strong> Think of it like studying for an exam with extra textbooks (the RWD), but the exam itself (cross-validation) is graded only on RCT data. If the external textbooks helped you learn real patterns, great – your exam score improves. If they taught you spurious associations driven by confounding, the exam catches that and those models get down-weighted.</p>
<p>We may have poor precision in the RCT alone for nuisance functions (Q) and (g). External data can improve the <em>learning</em> of these functions, but confounding in the RWD could distort:</p>
<ul>
<li>Outcome relationships</li>
<li>Treatment assignment mechanisms</li>
</ul>
<p>ES-CV-TMLE protects against this by:</p>
<ol type="1">
<li>Proposing multiple candidate nuisance models, some learned on:
<ul>
<li>RCT only</li>
<li>RWD only</li>
<li>Combined data</li>
</ul></li>
<li>Using <strong>cross-validation on the RCT</strong> to evaluate each model’s performance (e.g., via log-likelihood loss).</li>
<li>Choosing the best-performing nuisance model (or an ensemble of them) for TMLE.</li>
</ol>
<p>External data are “supervisors” but do not override the RCT.</p>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
ES-CV-TMLE Algorithm (Step by Step)
</div>
</div>
<div class="callout-body-container callout-body">
<ol type="1">
<li><p><strong>Train candidate models</strong> by pooling RCT and RWD data in different ways:</p>
<ul>
<li>(Q_{ ext{RCT}}): trained only on RCT</li>
<li>(Q_{ ext{RWD}}): trained only on RWD</li>
<li>(Q_{ ext{pool}}): trained on combined RCT+RWD</li>
</ul></li>
<li><p><strong>Evaluate each candidate</strong> using RCT data only:</p>
<ul>
<li>Run cross-validated evaluation (e.g., deviance, negative log-likelihood)</li>
</ul></li>
<li><p><strong>Select or weight candidates</strong> via SuperLearner-style metalearning.</p></li>
<li><p><strong>Run TMLE</strong> using the chosen Q (and similarly chosen g, if desired) on the RCT data.</p></li>
</ol>
<p>This preserves the RCT-based identification and uses RWD as an auxiliary data source for better prediction. The bottom line: even if the RWD is confounded, this procedure can only help (or do no harm) relative to using the RCT alone.</p>
</div>
</div>
<hr>
</section>
<section id="a-tmle-adaptive-targeted-maximum-likelihood-estimation" class="level2" data-number="15.6">
<h2 data-number="15.6" class="anchored" data-anchor-id="a-tmle-adaptive-targeted-maximum-likelihood-estimation"><span class="header-section-number">15.6</span> 5. A-TMLE: Adaptive Targeted Maximum Likelihood Estimation</h2>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
A-TMLE: Adaptive Combination in Plain Language
</div>
</div>
<div class="callout-body-container callout-body">
<p>Think of A-TMLE as a “meta-analysis machine” that does not just combine study results, but adaptively learns the best way to blend multiple estimators from different data sources. Where ES-CV-TMLE selects among candidate prediction models (a step inside the estimator), A-TMLE operates one level up: it selects among or blends entire estimators, each of which may use different data sources or modeling strategies. The data themselves decide how much to trust each source.</p>
</div>
</div>
<p><strong>Adaptive TMLE (A-TMLE)</strong> generalizes ES-CV-TMLE to the estimator level.</p>
<p>Instead of combining candidate <strong>nuisance models</strong>, A-TMLE combines candidate <strong>estimators</strong> (e.g., separate hybrid analyses):</p>
<ul>
<li>TMLE using RCT only</li>
<li>TMLE using RWD only (carefully adjusted)</li>
<li>TMLE using both RCT + RWD in a joint model</li>
<li>Other candidate estimators</li>
</ul>
<p>It then uses a SuperLearner-style convex combination of these estimators to:</p>
<blockquote class="blockquote">
<p>Minimize cross-validated risk, yielding an adaptive, doubly robust final estimate.</p>
</blockquote>
<section id="why-a-tmle" class="level3" data-number="15.6.1">
<h3 data-number="15.6.1" class="anchored" data-anchor-id="why-a-tmle"><span class="header-section-number">15.6.1</span> 5.1 Why A-TMLE?</h3>
<p>Multiple data sources can provide:</p>
<ul>
<li>High internal validity (RCT)<br>
</li>
<li>High external validity (RWD)<br>
</li>
<li>Different types of bias and variance</li>
</ul>
<p>A-TMLE lets the data decide the optimal combination, subject to:</p>
<ul>
<li>Constraints (e.g., RCT estimator always included)<br>
</li>
<li>Hierarchical preferences (e.g., more weight on RCT when conflict arises)</li>
</ul>
</section>
<section id="mathematical-structure" class="level3" data-number="15.6.2">
<h3 data-number="15.6.2" class="anchored" data-anchor-id="mathematical-structure"><span class="header-section-number">15.6.2</span> 5.2 Mathematical structure</h3>
<p>Let ( _1, , _K) be candidate estimators of the same target parameter ().</p>
<p>A-TMLE constructs:</p>
<p>[ <em>{ ext{A-TMLE}} = </em>{k=1}^K lpha_k _k ]</p>
<p>with</p>
<ul>
<li>(lpha_k )<br>
</li>
<li>(_k lpha_k = 1)</li>
</ul>
<p>Weights (lpha) are chosen to minimize cross-validated loss (e.g., squared error of influence curves).</p>
<hr>
</section>
</section>
<section id="example-hybrid-workflow-conceptual" class="level2" data-number="15.7">
<h2 data-number="15.7" class="anchored" data-anchor-id="example-hybrid-workflow-conceptual"><span class="header-section-number">15.7</span> 6. Example Hybrid Workflow (Conceptual)</h2>
<p>Consider:</p>
<ul>
<li>RCT: experimental vs placebo<br>
</li>
<li>RWD: observational comparison between experimental drug and standard-of-care</li>
</ul>
<section id="tmle-using-rct-only" class="level3" data-number="15.7.1">
<h3 data-number="15.7.1" class="anchored" data-anchor-id="tmle-using-rct-only"><span class="header-section-number">15.7.1</span> 6.1 TMLE using RCT only</h3>
<div class="sourceCode" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>tmle_rct <span class="ot">&lt;-</span> <span class="fu">tmle</span>(</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">Y =</span> Y_rct,</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">A =</span> A_rct,</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">W =</span> W_rct,</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">family =</span> <span class="st">"binomial"</span>,</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">Q.SL.library =</span> <span class="fu">c</span>(<span class="st">"SL.glm"</span>, <span class="st">"SL.ranger"</span>),</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">g.SL.library =</span> <span class="fu">c</span>(<span class="st">"SL.glm"</span>, <span class="st">"SL.ranger"</span>)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>psi_rct <span class="ot">&lt;-</span> tmle_rct<span class="sc">$</span>estimates<span class="sc">$</span>ATE<span class="sc">$</span>psi</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="tmle-using-rwd-careful-confounding-control" class="level3" data-number="15.7.2">
<h3 data-number="15.7.2" class="anchored" data-anchor-id="tmle-using-rwd-careful-confounding-control"><span class="header-section-number">15.7.2</span> 6.2 TMLE using RWD (careful confounding control)</h3>
<div class="sourceCode" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>tmle_rwd <span class="ot">&lt;-</span> <span class="fu">tmle</span>(</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">Y =</span> Y_rwd,</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">A =</span> A_rwd,</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">W =</span> W_rwd,</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">family =</span> <span class="st">"binomial"</span>,</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">Q.SL.library =</span> <span class="fu">c</span>(<span class="st">"SL.glm"</span>, <span class="st">"SL.ranger"</span>),</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">g.SL.library =</span> <span class="fu">c</span>(<span class="st">"SL.glm"</span>, <span class="st">"SL.ranger"</span>)</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>psi_rwd <span class="ot">&lt;-</span> tmle_rwd<span class="sc">$</span>estimates<span class="sc">$</span>ATE<span class="sc">$</span>psi</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="pooled-source-tmle" class="level3" data-number="15.7.3">
<h3 data-number="15.7.3" class="anchored" data-anchor-id="pooled-source-tmle"><span class="header-section-number">15.7.3</span> 6.3 Pooled-source TMLE</h3>
<div class="sourceCode" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>Y_pool <span class="ot">&lt;-</span> <span class="fu">c</span>(Y_rct, Y_rwd)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>A_pool <span class="ot">&lt;-</span> <span class="fu">c</span>(A_rct, A_rwd)</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>W_pool <span class="ot">&lt;-</span> <span class="fu">rbind</span>(W_rct, W_rwd)</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>tmle_pool <span class="ot">&lt;-</span> <span class="fu">tmle</span>(</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">Y =</span> Y_pool,</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">A =</span> A_pool,</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">W =</span> W_pool,</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">family =</span> <span class="st">"binomial"</span>,</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">Q.SL.library =</span> <span class="fu">c</span>(<span class="st">"SL.glm"</span>, <span class="st">"SL.ranger"</span>),</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">g.SL.library =</span> <span class="fu">c</span>(<span class="st">"SL.glm"</span>, <span class="st">"SL.ranger"</span>)</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>psi_pool <span class="ot">&lt;-</span> tmle_pool<span class="sc">$</span>estimates<span class="sc">$</span>ATE<span class="sc">$</span>psi</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="adaptive-combination-a-tmle-style-idea" class="level3" data-number="15.7.4">
<h3 data-number="15.7.4" class="anchored" data-anchor-id="adaptive-combination-a-tmle-style-idea"><span class="header-section-number">15.7.4</span> 6.4 Adaptive combination (A-TMLE style idea)</h3>
<div class="sourceCode" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>candidates <span class="ot">&lt;-</span> <span class="fu">c</span>(psi_rct, psi_rwd, psi_pool)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Placeholder: in practice, you would build a loss function based on influence curves</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="co"># and use constrained optimization (e.g., nnls) with cross-validation to find weights.</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>weights <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">0.6</span>, <span class="fl">0.0</span>, <span class="fl">0.4</span>)  <span class="co"># e.g., chosen by cross-validation</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>weights <span class="ot">&lt;-</span> weights <span class="sc">/</span> <span class="fu">sum</span>(weights)</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>psi_atmle <span class="ot">&lt;-</span> <span class="fu">sum</span>(weights <span class="sc">*</span> candidates)</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>psi_atmle</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>In a true A-TMLE implementation, the weights would be:</p>
<ul>
<li>Estimated based on CV risk<br>
</li>
<li>Possibly constrained to ensure heavier emphasis on RCT-based estimators</li>
</ul>
<hr>
</section>
</section>
<section id="practical-considerations-and-diagnostics-for-hybrid-designs" class="level2" data-number="15.8">
<h2 data-number="15.8" class="anchored" data-anchor-id="practical-considerations-and-diagnostics-for-hybrid-designs"><span class="header-section-number">15.8</span> 7. Practical Considerations and Diagnostics for Hybrid Designs</h2>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
7.1 Harmonization
</div>
</div>
<div class="callout-body-container callout-body">
<p>Before attempting hybrid estimation, you must ensure that the two data sources are speaking the same language. This is often the most labor-intensive step.</p>
<ul>
<li>Align endpoint definitions and censoring rules</li>
<li>Harmonize covariates (coding, units, ranges)</li>
<li>Confirm consistent definition of “treatment” across sources</li>
</ul>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
7.2 Assess Similarity Between RCT and RWD
</div>
</div>
<div class="callout-body-container callout-body">
<p>Check covariate distributions before you borrow. Visualization is your first line of defense:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">bind_rows</span>(</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>  W_rct <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">source =</span> “RCT”),</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>  W_rwd <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">source =</span> “RWD”)</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="sc">-</span>source) <span class="sc">%&gt;%</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> value, <span class="at">fill =</span> source)) <span class="sc">+</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="at">alpha =</span> <span class="fl">0.4</span>) <span class="sc">+</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> name, <span class="at">scales =</span> “free”)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Look for:</p>
<ul>
<li>Large discrepancies –&gt; may require transportability modeling</li>
<li>Non-overlapping regions –&gt; positivity issues</li>
</ul>
</div>
</div>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
7.3 Sensitivity Analyses Are Not Optional
</div>
</div>
<div class="callout-body-container callout-body">
<p>Every hybrid analysis should include sensitivity checks that quantify how much the result depends on the external data:</p>
<ul>
<li>Re-estimate using RCT-only TMLE (your “no-borrowing” benchmark)</li>
<li>Vary the degree of borrowing (e.g., by up-weighting/down-weighting RWD in hybrid estimators)</li>
<li>Use E-values or quantitative bias analysis (QBA) to examine the impact of unmeasured confounding in the RWD component</li>
<li>Apply negative control analyses in the RWD part</li>
</ul>
<p>If your conclusions change dramatically depending on how much RWD you include, that is a signal that the external data may be introducing bias rather than reducing variance.</p>
</div>
</div>
<hr>
</section>
<section id="when-to-use-hybrid-designs-and-when-not-to" class="level2" data-number="15.9">
<h2 data-number="15.9" class="anchored" data-anchor-id="when-to-use-hybrid-designs-and-when-not-to"><span class="header-section-number">15.9</span> 8. When to Use Hybrid Designs (and When Not To)</h2>
<p>Hybrid designs are <strong>appropriate</strong> when:</p>
<ul>
<li>RWD is of reasonable quality<br>
</li>
<li>Key confounders in RWD are measured<br>
</li>
<li>Outcome definitions are compatible<br>
</li>
<li>There is substantial overlap in covariate distributions<br>
</li>
<li>The trial alone is underpowered or narrow in scope</li>
</ul>
<div class="callout callout-style-default callout-caution callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
When Hybrid Designs Are Inappropriate
</div>
</div>
<div class="callout-body-container callout-body">
<p>They may be <strong>inappropriate</strong> when:</p>
<ul>
<li><strong>RWD is subject to severe unmeasured confounding</strong>: If the observational data lack key confounders (e.g., disease severity, performance status), borrowing from RWD can introduce more bias than it resolves.</li>
<li><strong>Data sources are poorly harmonized</strong>: If outcome definitions, covariate coding, or follow-up schedules differ substantially and cannot be reconciled, the hybrid estimator is comparing incompatible quantities.</li>
<li><strong>There is little overlap in covariate or treatment patterns</strong>: If the trial population and RWD population occupy different regions of the covariate space, extrapolation replaces estimation.</li>
<li><strong>The trial is already well-powered for the primary endpoint</strong>: In this case, the marginal precision gain from RWD may not justify the additional assumptions and complexity.</li>
</ul>
<p>In those cases, a pure RCT analysis with careful interpretation may be preferable. Adding RWD is not always better – it is better only when the assumptions hold and the data quality warrants it.</p>
</div>
</div>
<hr>
</section>
<section id="summary" class="level2" data-number="15.10">
<h2 data-number="15.10" class="anchored" data-anchor-id="summary"><span class="header-section-number">15.10</span> 9. Summary</h2>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Chapter Takeaways
</div>
</div>
<div class="callout-body-container callout-body">
<p>Hybrid RCT-RWD designs extend the causal roadmap to a richer evidence ecosystem:</p>
<ul>
<li><strong>External controls</strong> can augment sparse trial control arms</li>
<li><strong>Transport and generalizability methods</strong> can extend findings to broader populations</li>
<li><strong>ES-CV-TMLE</strong> leverages RWD for nuisance modeling while preserving internal validity</li>
<li><strong>A-TMLE</strong> adaptively combines estimators from multiple sources using targeted learning and cross-validation</li>
</ul>
<p>Used carefully, these tools can:</p>
<ul>
<li>Improve precision</li>
<li>Enhance generalizability</li>
<li>Provide robust, transparent evidence that respects the strengths and limitations of both RCT and RWD</li>
</ul>
<p>The overarching principle for MPH-trained epidemiologists: hybrid designs do not weaken the RCT – they extend it. But the extension is only as trustworthy as the assumptions and data quality behind the RWD component. Always report the RCT-only result alongside the hybrid result so readers can judge for themselves.</p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sessionInfo</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>R version 4.4.2 (2024-10-31 ucrt)
Platform: x86_64-w64-mingw32/x64
Running under: Windows 11 x64 (build 26200)

Matrix products: default


locale:
[1] LC_COLLATE=English_United States.utf8 
[2] LC_CTYPE=English_United States.utf8   
[3] LC_MONETARY=English_United States.utf8
[4] LC_NUMERIC=C                          
[5] LC_TIME=English_United States.utf8    

time zone: America/Los_Angeles
tzcode source: internal

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base     

loaded via a namespace (and not attached):
 [1] htmlwidgets_1.6.4 compiler_4.4.2    fastmap_1.2.0     cli_3.6.5        
 [5] tools_4.4.2       htmltools_0.5.8.1 rstudioapi_0.17.1 yaml_2.3.10      
 [9] rmarkdown_2.29    knitr_1.49        jsonlite_2.0.0    xfun_0.49        
[13] digest_0.6.37     rlang_1.1.6       evaluate_1.0.5   </code></pre>
</div>
</div>
<hr>
</section>
<section id="software-implementation-r" class="level2" data-number="15.11">
<h2 data-number="15.11" class="anchored" data-anchor-id="software-implementation-r"><span class="header-section-number">15.11</span> Software Implementation (R)</h2>
<p>This example demonstrates an <strong>external control arm</strong> analysis skeleton where a randomized trial is augmented with real-world data (RWD). We simulate an RCT treatment arm and an external RWD control arm, then estimate the ATE using TMLE with study-membership adjustment.</p>
<ul>
<li>Simulates a small RCT (treatment arm only) and a larger RWD cohort (controls)</li>
<li>Includes a study-membership indicator <span class="math inline">\(S\)</span> to adjust for systematic differences</li>
<li>Uses <code>tmle</code> to estimate the treatment effect while adjusting for <span class="math inline">\(W\)</span> and <span class="math inline">\(S\)</span></li>
<li>Notes where specialized packages like <code>EScvtmle</code> would extend this approach</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="do">## ── Simulate RCT treatment arm ──</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>n_rct <span class="ot">&lt;-</span> <span class="dv">150</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>W1_rct <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(n_rct, <span class="at">mean =</span> <span class="fl">0.2</span>)</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>W2_rct <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(n_rct, <span class="dv">1</span>, <span class="fl">0.4</span>)</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>A_rct  <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">1</span>, n_rct)  <span class="co"># all treated</span></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>Y_rct  <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(n_rct, <span class="dv">1</span>, <span class="fu">plogis</span>(<span class="sc">-</span><span class="dv">1</span> <span class="sc">+</span> <span class="fl">0.6</span> <span class="sc">*</span> <span class="dv">1</span> <span class="sc">+</span> <span class="fl">0.5</span> <span class="sc">*</span> W1_rct <span class="sc">+</span> <span class="fl">0.3</span> <span class="sc">*</span> W2_rct))</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a><span class="do">## ── Simulate RWD external controls ──</span></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>n_rwd <span class="ot">&lt;-</span> <span class="dv">400</span></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>W1_rwd <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(n_rwd, <span class="at">mean =</span> <span class="sc">-</span><span class="fl">0.1</span>)   <span class="co"># slight covariate shift</span></span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>W2_rwd <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(n_rwd, <span class="dv">1</span>, <span class="fl">0.5</span>)</span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>A_rwd  <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">0</span>, n_rwd)  <span class="co"># all control</span></span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>Y_rwd  <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(n_rwd, <span class="dv">1</span>, <span class="fu">plogis</span>(<span class="sc">-</span><span class="dv">1</span> <span class="sc">+</span> <span class="fl">0.6</span> <span class="sc">*</span> <span class="dv">0</span> <span class="sc">+</span> <span class="fl">0.5</span> <span class="sc">*</span> W1_rwd <span class="sc">+</span> <span class="fl">0.3</span> <span class="sc">*</span> W2_rwd))</span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a><span class="do">## ── Combined analysis dataset ──</span></span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a>  <span class="at">W1 =</span> <span class="fu">c</span>(W1_rct, W1_rwd),</span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a>  <span class="at">W2 =</span> <span class="fu">c</span>(W2_rct, W2_rwd),</span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a>  <span class="at">S  =</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="dv">1</span>, n_rct), <span class="fu">rep</span>(<span class="dv">0</span>, n_rwd)),   <span class="co"># study membership</span></span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a>  <span class="at">A  =</span> <span class="fu">c</span>(A_rct, A_rwd),</span>
<span id="cb8-23"><a href="#cb8-23" aria-hidden="true" tabindex="-1"></a>  <span class="at">Y  =</span> <span class="fu">c</span>(Y_rct, Y_rwd)</span>
<span id="cb8-24"><a href="#cb8-24" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb8-25"><a href="#cb8-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-26"><a href="#cb8-26" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">requireNamespace</span>(<span class="st">"tmle"</span>, <span class="at">quietly =</span> <span class="cn">TRUE</span>)) {</span>
<span id="cb8-27"><a href="#cb8-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(tmle)</span>
<span id="cb8-28"><a href="#cb8-28" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Include study indicator S as a covariate to adjust for</span></span>
<span id="cb8-29"><a href="#cb8-29" aria-hidden="true" tabindex="-1"></a>  <span class="do">## population differences between RCT and RWD</span></span>
<span id="cb8-30"><a href="#cb8-30" aria-hidden="true" tabindex="-1"></a>  W <span class="ot">&lt;-</span> dat[, <span class="fu">c</span>(<span class="st">"W1"</span>, <span class="st">"W2"</span>, <span class="st">"S"</span>)]</span>
<span id="cb8-31"><a href="#cb8-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-32"><a href="#cb8-32" aria-hidden="true" tabindex="-1"></a>  fit <span class="ot">&lt;-</span> <span class="fu">tmle</span>(</span>
<span id="cb8-33"><a href="#cb8-33" aria-hidden="true" tabindex="-1"></a>    <span class="at">Y =</span> dat<span class="sc">$</span>Y, <span class="at">A =</span> dat<span class="sc">$</span>A, <span class="at">W =</span> W,</span>
<span id="cb8-34"><a href="#cb8-34" aria-hidden="true" tabindex="-1"></a>    <span class="at">family =</span> <span class="st">"binomial"</span>,</span>
<span id="cb8-35"><a href="#cb8-35" aria-hidden="true" tabindex="-1"></a>    <span class="at">Q.SL.library =</span> <span class="fu">c</span>(<span class="st">"SL.glm"</span>, <span class="st">"SL.mean"</span>),</span>
<span id="cb8-36"><a href="#cb8-36" aria-hidden="true" tabindex="-1"></a>    <span class="at">g.SL.library  =</span> <span class="fu">c</span>(<span class="st">"SL.glm"</span>, <span class="st">"SL.mean"</span>)</span>
<span id="cb8-37"><a href="#cb8-37" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb8-38"><a href="#cb8-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-39"><a href="#cb8-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"── Hybrid RCT + RWD external control analysis ──</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb8-40"><a href="#cb8-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"ATE (risk difference):"</span>, <span class="fu">round</span>(fit<span class="sc">$</span>estimates<span class="sc">$</span>ATE<span class="sc">$</span>psi, <span class="dv">4</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb8-41"><a href="#cb8-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"95% CI:"</span>, <span class="fu">round</span>(fit<span class="sc">$</span>estimates<span class="sc">$</span>ATE<span class="sc">$</span>CI, <span class="dv">4</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb8-42"><a href="#cb8-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">Note: For more sophisticated approaches, see:</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb8-43"><a href="#cb8-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"  - EScvtmle: external-source cross-validated TMLE</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb8-44"><a href="#cb8-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"  - A-TMLE: adaptive TMLE for data-adaptive borrowing</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb8-45"><a href="#cb8-45" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb8-46"><a href="#cb8-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">message</span>(<span class="st">"Install the 'tmle' package:  install.packages('tmle')"</span>)</span>
<span id="cb8-47"><a href="#cb8-47" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>


<!-- -->

</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/amertens\.github\.io\/causal-learning-handbook\/");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./03-05-advanced-diagnostics.html" class="pagination-link" aria-label="Chapter 3.5: Advanced Diagnostics and Sensitivity Analyses">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Chapter 3.5: Advanced Diagnostics and Sensitivity Analyses</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./03-07-longitudinal-td-confounding.html" class="pagination-link" aria-label="Chapter 3.7: Imperfect Adherence, Time-Varying Confounding, and Longitudinal TMLE">
        <span class="nav-page-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Chapter 3.7: Imperfect Adherence, Time-Varying Confounding, and Longitudinal TMLE</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb9" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "Chapter 3.6: When RWD Meets RCT – Hybrid Designs"</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="an">format:</span><span class="co"> html</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a><span class="fu"># Chapter 3.6  </span></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a><span class="fu">## When RWD Meets RCT – Hybrid Designs for Causal Inference  </span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>*Combining randomized and observational data to improve precision and generalizability*</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>Randomized controlled trials (RCTs) are the gold standard for causal inference.  </span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>But they are:</span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Expensive and slow  </span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Often underpowered for rare events and subgroup effects  </span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Conducted in selective populations  </span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Not always feasible or ethical  </span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a>Real-world data (RWD) — registries, EHR, claims — provide:</span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Large, diverse populations  </span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Naturalistic treatment patterns  </span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Long-term safety follow-up  </span>
<span id="cb9-23"><a href="#cb9-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-24"><a href="#cb9-24" aria-hidden="true" tabindex="-1"></a>**Hybrid RCT–RWD designs** aim to combine:</span>
<span id="cb9-25"><a href="#cb9-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-26"><a href="#cb9-26" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>The *internal validity* of RCTs  </span>
<span id="cb9-27"><a href="#cb9-27" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>The *external validity* and scale of RWD  </span>
<span id="cb9-28"><a href="#cb9-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-29"><a href="#cb9-29" aria-hidden="true" tabindex="-1"></a>This chapter introduces:</span>
<span id="cb9-30"><a href="#cb9-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-31"><a href="#cb9-31" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>Why hybrid designs are needed  </span>
<span id="cb9-32"><a href="#cb9-32" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>Types of hybrid designs with external controls  </span>
<span id="cb9-33"><a href="#cb9-33" aria-hidden="true" tabindex="-1"></a><span class="ss">3. </span>Transportability and generalizability concepts  </span>
<span id="cb9-34"><a href="#cb9-34" aria-hidden="true" tabindex="-1"></a><span class="ss">4. </span>ES-CV-TMLE (External Supervised Cross-Validated TMLE)  </span>
<span id="cb9-35"><a href="#cb9-35" aria-hidden="true" tabindex="-1"></a><span class="ss">5. </span>A-TMLE (Adaptive TMLE) for integrating multiple data sources  </span>
<span id="cb9-36"><a href="#cb9-36" aria-hidden="true" tabindex="-1"></a><span class="ss">6. </span>Practical considerations and diagnostics  </span>
<span id="cb9-37"><a href="#cb9-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-38"><a href="#cb9-38" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb9-39"><a href="#cb9-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-40"><a href="#cb9-40" aria-hidden="true" tabindex="-1"></a><span class="fu">## 1. Why Combine RCT and RWD?</span></span>
<span id="cb9-41"><a href="#cb9-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-42"><a href="#cb9-42" aria-hidden="true" tabindex="-1"></a>:::{.callout-important}</span>
<span id="cb9-43"><a href="#cb9-43" aria-hidden="true" tabindex="-1"></a><span class="fu">## Three Key Motivations for Hybrid RCT-RWD Designs</span></span>
<span id="cb9-44"><a href="#cb9-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-45"><a href="#cb9-45" aria-hidden="true" tabindex="-1"></a>As epidemiologists, we know that no single data source is perfect. RCTs give us internal validity but are often too small, too narrow, or too slow. RWD gives us scale and diversity but lacks randomization. Hybrid designs try to get the best of both worlds. There are three core reasons to combine them:</span>
<span id="cb9-46"><a href="#cb9-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-47"><a href="#cb9-47" aria-hidden="true" tabindex="-1"></a><span class="fu">### 1.1 Precision</span></span>
<span id="cb9-48"><a href="#cb9-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-49"><a href="#cb9-49" aria-hidden="true" tabindex="-1"></a>Trials may be underpowered for:</span>
<span id="cb9-50"><a href="#cb9-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-51"><a href="#cb9-51" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Rare safety endpoints</span>
<span id="cb9-52"><a href="#cb9-52" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Important subgroups</span>
<span id="cb9-53"><a href="#cb9-53" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Long-term secondary endpoints</span>
<span id="cb9-54"><a href="#cb9-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-55"><a href="#cb9-55" aria-hidden="true" tabindex="-1"></a>External RWD can add information and boost precision without enrolling more randomized patients.</span>
<span id="cb9-56"><a href="#cb9-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-57"><a href="#cb9-57" aria-hidden="true" tabindex="-1"></a><span class="fu">### 1.2 Generalizability</span></span>
<span id="cb9-58"><a href="#cb9-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-59"><a href="#cb9-59" aria-hidden="true" tabindex="-1"></a>RCT participants tend to:</span>
<span id="cb9-60"><a href="#cb9-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-61"><a href="#cb9-61" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Be younger and healthier</span>
<span id="cb9-62"><a href="#cb9-62" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Have fewer comorbidities</span>
<span id="cb9-63"><a href="#cb9-63" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Be more adherent and monitored</span>
<span id="cb9-64"><a href="#cb9-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-65"><a href="#cb9-65" aria-hidden="true" tabindex="-1"></a>Thus, trial results may not fully apply to routine-care populations. Think of the typical phase III oncology trial -- the enrolled patients are often younger and have better performance status than those you would see in a community oncology clinic.</span>
<span id="cb9-66"><a href="#cb9-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-67"><a href="#cb9-67" aria-hidden="true" tabindex="-1"></a><span class="fu">### 1.3 Feasibility and ethics</span></span>
<span id="cb9-68"><a href="#cb9-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-69"><a href="#cb9-69" aria-hidden="true" tabindex="-1"></a>Hybrid designs are useful when:</span>
<span id="cb9-70"><a href="#cb9-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-71"><a href="#cb9-71" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Placebo or standard randomized controls are unethical</span>
<span id="cb9-72"><a href="#cb9-72" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Only a single-arm trial is feasible</span>
<span id="cb9-73"><a href="#cb9-73" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Rapid evidence is needed (e.g., post-marketing surveillance, rare diseases)</span>
<span id="cb9-74"><a href="#cb9-74" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb9-75"><a href="#cb9-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-76"><a href="#cb9-76" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb9-77"><a href="#cb9-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-78"><a href="#cb9-78" aria-hidden="true" tabindex="-1"></a><span class="fu">## 2. Basic Hybrid Designs</span></span>
<span id="cb9-79"><a href="#cb9-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-80"><a href="#cb9-80" aria-hidden="true" tabindex="-1"></a>Several design patterns are commonly used.</span>
<span id="cb9-81"><a href="#cb9-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-82"><a href="#cb9-82" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb9-83"><a href="#cb9-83" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-84"><a href="#cb9-84" aria-hidden="true" tabindex="-1"></a>:::{.callout-note}</span>
<span id="cb9-85"><a href="#cb9-85" aria-hidden="true" tabindex="-1"></a><span class="fu">## External Control Arms</span></span>
<span id="cb9-86"><a href="#cb9-86" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-87"><a href="#cb9-87" aria-hidden="true" tabindex="-1"></a>In plain language, an **external control arm** means: instead of randomizing some patients to a control group within your trial, you borrow the control group from outside the trial -- typically from a registry, EHR database, or historical trial data.</span>
<span id="cb9-88"><a href="#cb9-88" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-89"><a href="#cb9-89" aria-hidden="true" tabindex="-1"></a>A **single-arm trial** (all patients get experimental treatment) may be compared against an **external control** arm from RWD.</span>
<span id="cb9-90"><a href="#cb9-90" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-91"><a href="#cb9-91" aria-hidden="true" tabindex="-1"></a>Use cases:</span>
<span id="cb9-92"><a href="#cb9-92" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-93"><a href="#cb9-93" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Oncology (historical controls)</span>
<span id="cb9-94"><a href="#cb9-94" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Rare diseases</span>
<span id="cb9-95"><a href="#cb9-95" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>When standard-of-care is well characterized</span>
<span id="cb9-96"><a href="#cb9-96" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb9-97"><a href="#cb9-97" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-98"><a href="#cb9-98" aria-hidden="true" tabindex="-1"></a>:::{.callout-warning}</span>
<span id="cb9-99"><a href="#cb9-99" aria-hidden="true" tabindex="-1"></a><span class="fu">## Challenges of External Controls</span></span>
<span id="cb9-100"><a href="#cb9-100" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-101"><a href="#cb9-101" aria-hidden="true" tabindex="-1"></a>External controls introduce serious methodological risks that every epidemiologist should scrutinize:</span>
<span id="cb9-102"><a href="#cb9-102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-103"><a href="#cb9-103" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Confounding by indication**: Patients in the RWD were not randomized. The reasons they received (or did not receive) a treatment are entangled with their prognosis.</span>
<span id="cb9-104"><a href="#cb9-104" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Differences in data capture**: The trial measures outcomes with protocol-specified visits, imaging schedules, and adjudication committees. The RWD may rely on billing codes, free-text notes, or inconsistent follow-up.</span>
<span id="cb9-105"><a href="#cb9-105" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Eligibility misalignment**: Trial patients passed strict inclusion/exclusion criteria. RWD patients may differ systematically.</span>
<span id="cb9-106"><a href="#cb9-106" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Calendar time and secular trends**: Changes in supportive care, diagnostic coding (e.g., ICD-9 to ICD-10 transitions), or standard-of-care over time can create spurious differences.</span>
<span id="cb9-107"><a href="#cb9-107" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-108"><a href="#cb9-108" aria-hidden="true" tabindex="-1"></a>Always ask: "Would the external controls have been eligible for the trial, and are their outcomes measured comparably?"</span>
<span id="cb9-109"><a href="#cb9-109" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb9-110"><a href="#cb9-110" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-111"><a href="#cb9-111" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb9-112"><a href="#cb9-112" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-113"><a href="#cb9-113" aria-hidden="true" tabindex="-1"></a>:::{.callout-tip}</span>
<span id="cb9-114"><a href="#cb9-114" aria-hidden="true" tabindex="-1"></a><span class="fu">## Augmented Control Arms</span></span>
<span id="cb9-115"><a href="#cb9-115" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-116"><a href="#cb9-116" aria-hidden="true" tabindex="-1"></a>Unlike a fully external control, an **augmented control arm** retains randomization within the trial -- you still have a concurrent randomized control group. The external RWD supplements it rather than replacing it entirely. Think of it as "topping up" your control arm with additional data.</span>
<span id="cb9-117"><a href="#cb9-117" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-118"><a href="#cb9-118" aria-hidden="true" tabindex="-1"></a>An RCT randomizes patients to:</span>
<span id="cb9-119"><a href="#cb9-119" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-120"><a href="#cb9-120" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Experimental treatment vs trial control (e.g., 2:1 randomization)</span>
<span id="cb9-121"><a href="#cb9-121" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-122"><a href="#cb9-122" aria-hidden="true" tabindex="-1"></a>But the trial control arm is **augmented** with external RWD controls to:</span>
<span id="cb9-123"><a href="#cb9-123" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-124"><a href="#cb9-124" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Improve precision</span>
<span id="cb9-125"><a href="#cb9-125" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Reduce required randomized control sample size</span>
<span id="cb9-126"><a href="#cb9-126" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Support safety and rare-event evaluation</span>
<span id="cb9-127"><a href="#cb9-127" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-128"><a href="#cb9-128" aria-hidden="true" tabindex="-1"></a>Borrowing can be:</span>
<span id="cb9-129"><a href="#cb9-129" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-130"><a href="#cb9-130" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Fixed (pre-specified)**: You decide before unblinding how much external data to incorporate.</span>
<span id="cb9-131"><a href="#cb9-131" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Dynamic / adaptive (data-driven)**: The degree of borrowing depends on how similar the RWD control outcomes are to the trial control outcomes (e.g., power prior, commensurate prior approaches).</span>
<span id="cb9-132"><a href="#cb9-132" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-133"><a href="#cb9-133" aria-hidden="true" tabindex="-1"></a>This is generally safer than a pure external control design because the concurrent randomized control arm serves as a built-in validity check.</span>
<span id="cb9-134"><a href="#cb9-134" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb9-135"><a href="#cb9-135" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-136"><a href="#cb9-136" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb9-137"><a href="#cb9-137" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-138"><a href="#cb9-138" aria-hidden="true" tabindex="-1"></a>:::{.callout-important}</span>
<span id="cb9-139"><a href="#cb9-139" aria-hidden="true" tabindex="-1"></a><span class="fu">## Transportability and Generalizability</span></span>
<span id="cb9-140"><a href="#cb9-140" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-141"><a href="#cb9-141" aria-hidden="true" tabindex="-1"></a>**In plain language**: “Transporting” a trial result means taking the causal effect estimated in the trial's selected population and asking, “What would this effect be in a different, broader population?” For example, if a trial enrolled mostly younger patients with good kidney function, transportability methods let you estimate what the treatment effect would be in the full population of Medicare beneficiaries -- including older, sicker patients who were excluded from the trial.</span>
<span id="cb9-142"><a href="#cb9-142" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-143"><a href="#cb9-143" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Generalizability** = extending results from the trial sample to the full population the trial was sampled from.</span>
<span id="cb9-144"><a href="#cb9-144" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Transportability** = extending results to an entirely different target population.</span>
<span id="cb9-145"><a href="#cb9-145" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-146"><a href="#cb9-146" aria-hidden="true" tabindex="-1"></a>You may have:</span>
<span id="cb9-147"><a href="#cb9-147" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-148"><a href="#cb9-148" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>An RCT effect estimate in a selected population</span>
<span id="cb9-149"><a href="#cb9-149" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>A target population in RWD</span>
<span id="cb9-150"><a href="#cb9-150" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-151"><a href="#cb9-151" aria-hidden="true" tabindex="-1"></a>Goal:</span>
<span id="cb9-152"><a href="#cb9-152" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-153"><a href="#cb9-153" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; *Transport* or *generalize* the trial effect to the RWD population.</span></span>
<span id="cb9-154"><a href="#cb9-154" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-155"><a href="#cb9-155" aria-hidden="true" tabindex="-1"></a>Requires:</span>
<span id="cb9-156"><a href="#cb9-156" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-157"><a href="#cb9-157" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Modeling the difference between trial and target populations</span>
<span id="cb9-158"><a href="#cb9-158" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Adjusting for “sampling bias” (who joins the trial)</span>
<span id="cb9-159"><a href="#cb9-159" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-160"><a href="#cb9-160" aria-hidden="true" tabindex="-1"></a>Techniques:</span>
<span id="cb9-161"><a href="#cb9-161" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-162"><a href="#cb9-162" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Inverse odds of sampling weights (IOSW)</span>
<span id="cb9-163"><a href="#cb9-163" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Transport / generalizability TMLE</span>
<span id="cb9-164"><a href="#cb9-164" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Doubly robust methods combining outcome and sampling models</span>
<span id="cb9-165"><a href="#cb9-165" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb9-166"><a href="#cb9-166" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-167"><a href="#cb9-167" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb9-168"><a href="#cb9-168" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-169"><a href="#cb9-169" aria-hidden="true" tabindex="-1"></a><span class="fu">## 3. Identification: Assumptions in Hybrid Settings</span></span>
<span id="cb9-170"><a href="#cb9-170" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-171"><a href="#cb9-171" aria-hidden="true" tabindex="-1"></a>Beyond usual RCT assumptions, hybrid designs require:</span>
<span id="cb9-172"><a href="#cb9-172" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-173"><a href="#cb9-173" aria-hidden="true" tabindex="-1"></a>:::{.callout-warning}</span>
<span id="cb9-174"><a href="#cb9-174" aria-hidden="true" tabindex="-1"></a><span class="fu">## Assumption 3.1: No Unmeasured Confounding (for External / Observational Arms)</span></span>
<span id="cb9-175"><a href="#cb9-175" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-176"><a href="#cb9-176" aria-hidden="true" tabindex="-1"></a>Within the external data:</span>
<span id="cb9-177"><a href="#cb9-177" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-178"><a href="#cb9-178" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Treatment-outcome confounding must be controlled using available covariates</span>
<span id="cb9-179"><a href="#cb9-179" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Residual confounding may bias the hybrid estimate</span>
<span id="cb9-180"><a href="#cb9-180" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-181"><a href="#cb9-181" aria-hidden="true" tabindex="-1"></a>In epi terms, this is the same exchangeability assumption you are familiar with from observational studies -- but now it applies specifically to the RWD component of your hybrid design. The RCT component is protected by randomization; the RWD component is not.</span>
<span id="cb9-182"><a href="#cb9-182" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb9-183"><a href="#cb9-183" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-184"><a href="#cb9-184" aria-hidden="true" tabindex="-1"></a>:::{.callout-warning}</span>
<span id="cb9-185"><a href="#cb9-185" aria-hidden="true" tabindex="-1"></a><span class="fu">## Assumption 3.2: Common Support (Overlap)</span></span>
<span id="cb9-186"><a href="#cb9-186" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-187"><a href="#cb9-187" aria-hidden="true" tabindex="-1"></a>The joint covariate space of:</span>
<span id="cb9-188"><a href="#cb9-188" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-189"><a href="#cb9-189" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>RCT participants</span>
<span id="cb9-190"><a href="#cb9-190" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>RWD patients</span>
<span id="cb9-191"><a href="#cb9-191" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-192"><a href="#cb9-192" aria-hidden="true" tabindex="-1"></a>must overlap, especially when:</span>
<span id="cb9-193"><a href="#cb9-193" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-194"><a href="#cb9-194" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Using RWD to estimate control outcomes</span>
<span id="cb9-195"><a href="#cb9-195" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Transporting effects across populations</span>
<span id="cb9-196"><a href="#cb9-196" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-197"><a href="#cb9-197" aria-hidden="true" tabindex="-1"></a>This is the positivity assumption applied across data sources. If trial participants are systematically different from RWD patients in ways that matter for the outcome, you cannot borrow information reliably. Check covariate distributions carefully before proceeding.</span>
<span id="cb9-198"><a href="#cb9-198" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb9-199"><a href="#cb9-199" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-200"><a href="#cb9-200" aria-hidden="true" tabindex="-1"></a>:::{.callout-warning}</span>
<span id="cb9-201"><a href="#cb9-201" aria-hidden="true" tabindex="-1"></a><span class="fu">## Assumption 3.3: Consistency Across Sources</span></span>
<span id="cb9-202"><a href="#cb9-202" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-203"><a href="#cb9-203" aria-hidden="true" tabindex="-1"></a>Medical coding, endpoint definitions, and measurement schemes should be compatible (or harmonized).</span>
<span id="cb9-204"><a href="#cb9-204" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-205"><a href="#cb9-205" aria-hidden="true" tabindex="-1"></a>For example, "progression-free survival" measured by central radiology review in a trial is not the same as "progression-free survival" inferred from claims data or chart review. If outcome definitions differ between the RCT and RWD, the hybrid estimator conflates apples and oranges.</span>
<span id="cb9-206"><a href="#cb9-206" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb9-207"><a href="#cb9-207" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-208"><a href="#cb9-208" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb9-209"><a href="#cb9-209" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-210"><a href="#cb9-210" aria-hidden="true" tabindex="-1"></a><span class="fu">## 4. ES-CV-TMLE: External Supervised Cross-Validated TMLE</span></span>
<span id="cb9-211"><a href="#cb9-211" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-212"><a href="#cb9-212" aria-hidden="true" tabindex="-1"></a>**ES-CV-TMLE (External Supervised Cross-Validated TMLE)** is a targeted learning approach that:</span>
<span id="cb9-213"><a href="#cb9-213" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-214"><a href="#cb9-214" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Uses **external data (RWD)** to help train nuisance models (e.g., outcome regressions)  </span>
<span id="cb9-215"><a href="#cb9-215" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Validates and selects among them using **cross-validation in the RCT only**  </span>
<span id="cb9-216"><a href="#cb9-216" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Ensures external data do not degrade the validity of RCT-based estimation  </span>
<span id="cb9-217"><a href="#cb9-217" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-218"><a href="#cb9-218" aria-hidden="true" tabindex="-1"></a>:::{.callout-note}</span>
<span id="cb9-219"><a href="#cb9-219" aria-hidden="true" tabindex="-1"></a><span class="fu">## ES-CV-TMLE: The Core Insight</span></span>
<span id="cb9-220"><a href="#cb9-220" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-221"><a href="#cb9-221" aria-hidden="true" tabindex="-1"></a>Here is the key idea in plain language: **External data help you train better prediction models, but the RCT is the judge.** Think of it like studying for an exam with extra textbooks (the RWD), but the exam itself (cross-validation) is graded only on RCT data. If the external textbooks helped you learn real patterns, great -- your exam score improves. If they taught you spurious associations driven by confounding, the exam catches that and those models get down-weighted.</span>
<span id="cb9-222"><a href="#cb9-222" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-223"><a href="#cb9-223" aria-hidden="true" tabindex="-1"></a>We may have poor precision in the RCT alone for nuisance functions <span class="sc">\(</span>Q<span class="sc">\)</span> and <span class="sc">\(</span>g<span class="sc">\)</span>.</span>
<span id="cb9-224"><a href="#cb9-224" aria-hidden="true" tabindex="-1"></a>External data can improve the *learning* of these functions, but confounding in the RWD could distort:</span>
<span id="cb9-225"><a href="#cb9-225" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-226"><a href="#cb9-226" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Outcome relationships</span>
<span id="cb9-227"><a href="#cb9-227" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Treatment assignment mechanisms</span>
<span id="cb9-228"><a href="#cb9-228" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-229"><a href="#cb9-229" aria-hidden="true" tabindex="-1"></a>ES-CV-TMLE protects against this by:</span>
<span id="cb9-230"><a href="#cb9-230" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-231"><a href="#cb9-231" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>Proposing multiple candidate nuisance models, some learned on:</span>
<span id="cb9-232"><a href="#cb9-232" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>RCT only</span>
<span id="cb9-233"><a href="#cb9-233" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>RWD only</span>
<span id="cb9-234"><a href="#cb9-234" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Combined data</span>
<span id="cb9-235"><a href="#cb9-235" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-236"><a href="#cb9-236" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>Using **cross-validation on the RCT** to evaluate each model’s performance (e.g., via log-likelihood loss).</span>
<span id="cb9-237"><a href="#cb9-237" aria-hidden="true" tabindex="-1"></a><span class="ss">3. </span>Choosing the best-performing nuisance model (or an ensemble of them) for TMLE.</span>
<span id="cb9-238"><a href="#cb9-238" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-239"><a href="#cb9-239" aria-hidden="true" tabindex="-1"></a>External data are “supervisors” but do not override the RCT.</span>
<span id="cb9-240"><a href="#cb9-240" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb9-241"><a href="#cb9-241" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-242"><a href="#cb9-242" aria-hidden="true" tabindex="-1"></a>:::{.callout-tip}</span>
<span id="cb9-243"><a href="#cb9-243" aria-hidden="true" tabindex="-1"></a><span class="fu">## ES-CV-TMLE Algorithm (Step by Step)</span></span>
<span id="cb9-244"><a href="#cb9-244" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-245"><a href="#cb9-245" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>**Train candidate models** by pooling RCT and RWD data in different ways:</span>
<span id="cb9-246"><a href="#cb9-246" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span><span class="sc">\(</span>Q_{  ext{RCT}}<span class="sc">\)</span>: trained only on RCT</span>
<span id="cb9-247"><a href="#cb9-247" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span><span class="sc">\(</span>Q_{  ext{RWD}}<span class="sc">\)</span>: trained only on RWD</span>
<span id="cb9-248"><a href="#cb9-248" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span><span class="sc">\(</span>Q_{  ext{pool}}<span class="sc">\)</span>: trained on combined RCT+RWD</span>
<span id="cb9-249"><a href="#cb9-249" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-250"><a href="#cb9-250" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>**Evaluate each candidate** using RCT data only:</span>
<span id="cb9-251"><a href="#cb9-251" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Run cross-validated evaluation (e.g., deviance, negative log-likelihood)</span>
<span id="cb9-252"><a href="#cb9-252" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-253"><a href="#cb9-253" aria-hidden="true" tabindex="-1"></a><span class="ss">3. </span>**Select or weight candidates** via SuperLearner-style metalearning.</span>
<span id="cb9-254"><a href="#cb9-254" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-255"><a href="#cb9-255" aria-hidden="true" tabindex="-1"></a><span class="ss">4. </span>**Run TMLE** using the chosen Q (and similarly chosen g, if desired) on the RCT data.</span>
<span id="cb9-256"><a href="#cb9-256" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-257"><a href="#cb9-257" aria-hidden="true" tabindex="-1"></a>This preserves the RCT-based identification and uses RWD as an auxiliary data source for better prediction. The bottom line: even if the RWD is confounded, this procedure can only help (or do no harm) relative to using the RCT alone.</span>
<span id="cb9-258"><a href="#cb9-258" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb9-259"><a href="#cb9-259" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-260"><a href="#cb9-260" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb9-261"><a href="#cb9-261" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-262"><a href="#cb9-262" aria-hidden="true" tabindex="-1"></a><span class="fu">## 5. A-TMLE: Adaptive Targeted Maximum Likelihood Estimation</span></span>
<span id="cb9-263"><a href="#cb9-263" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-264"><a href="#cb9-264" aria-hidden="true" tabindex="-1"></a>:::{.callout-note}</span>
<span id="cb9-265"><a href="#cb9-265" aria-hidden="true" tabindex="-1"></a><span class="fu">## A-TMLE: Adaptive Combination in Plain Language</span></span>
<span id="cb9-266"><a href="#cb9-266" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-267"><a href="#cb9-267" aria-hidden="true" tabindex="-1"></a>Think of A-TMLE as a "meta-analysis machine" that does not just combine study results, but adaptively learns the best way to blend multiple estimators from different data sources. Where ES-CV-TMLE selects among candidate prediction models (a step inside the estimator), A-TMLE operates one level up: it selects among or blends entire estimators, each of which may use different data sources or modeling strategies. The data themselves decide how much to trust each source.</span>
<span id="cb9-268"><a href="#cb9-268" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb9-269"><a href="#cb9-269" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-270"><a href="#cb9-270" aria-hidden="true" tabindex="-1"></a>**Adaptive TMLE (A-TMLE)** generalizes ES-CV-TMLE to the estimator level.</span>
<span id="cb9-271"><a href="#cb9-271" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-272"><a href="#cb9-272" aria-hidden="true" tabindex="-1"></a>Instead of combining candidate **nuisance models**, A-TMLE combines candidate **estimators** (e.g., separate hybrid analyses):</span>
<span id="cb9-273"><a href="#cb9-273" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-274"><a href="#cb9-274" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>TMLE using RCT only</span>
<span id="cb9-275"><a href="#cb9-275" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>TMLE using RWD only (carefully adjusted)</span>
<span id="cb9-276"><a href="#cb9-276" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>TMLE using both RCT + RWD in a joint model</span>
<span id="cb9-277"><a href="#cb9-277" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Other candidate estimators</span>
<span id="cb9-278"><a href="#cb9-278" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-279"><a href="#cb9-279" aria-hidden="true" tabindex="-1"></a>It then uses a SuperLearner-style convex combination of these estimators to:</span>
<span id="cb9-280"><a href="#cb9-280" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-281"><a href="#cb9-281" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; Minimize cross-validated risk, yielding an adaptive, doubly robust final estimate.</span></span>
<span id="cb9-282"><a href="#cb9-282" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-283"><a href="#cb9-283" aria-hidden="true" tabindex="-1"></a><span class="fu">### 5.1 Why A-TMLE?</span></span>
<span id="cb9-284"><a href="#cb9-284" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-285"><a href="#cb9-285" aria-hidden="true" tabindex="-1"></a>Multiple data sources can provide:</span>
<span id="cb9-286"><a href="#cb9-286" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-287"><a href="#cb9-287" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>High internal validity (RCT)  </span>
<span id="cb9-288"><a href="#cb9-288" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>High external validity (RWD)  </span>
<span id="cb9-289"><a href="#cb9-289" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Different types of bias and variance  </span>
<span id="cb9-290"><a href="#cb9-290" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-291"><a href="#cb9-291" aria-hidden="true" tabindex="-1"></a>A-TMLE lets the data decide the optimal combination, subject to:</span>
<span id="cb9-292"><a href="#cb9-292" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-293"><a href="#cb9-293" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Constraints (e.g., RCT estimator always included)  </span>
<span id="cb9-294"><a href="#cb9-294" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Hierarchical preferences (e.g., more weight on RCT when conflict arises)</span>
<span id="cb9-295"><a href="#cb9-295" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-296"><a href="#cb9-296" aria-hidden="true" tabindex="-1"></a><span class="fu">### 5.2 Mathematical structure</span></span>
<span id="cb9-297"><a href="#cb9-297" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-298"><a href="#cb9-298" aria-hidden="true" tabindex="-1"></a>Let <span class="sc">\(</span> \hat\Psi_1, \dots, \hat\Psi_K<span class="sc">\)</span> be candidate estimators of the same target parameter <span class="sc">\(</span>\Psi<span class="sc">\)</span>.</span>
<span id="cb9-299"><a href="#cb9-299" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-300"><a href="#cb9-300" aria-hidden="true" tabindex="-1"></a>A-TMLE constructs:</span>
<span id="cb9-301"><a href="#cb9-301" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-302"><a href="#cb9-302" aria-hidden="true" tabindex="-1"></a><span class="sc">\[</span></span>
<span id="cb9-303"><a href="#cb9-303" aria-hidden="true" tabindex="-1"></a>\hat\Psi_{  ext{A-TMLE}} = \sum_{k=1}^K lpha_k \hat\Psi_k</span>
<span id="cb9-304"><a href="#cb9-304" aria-hidden="true" tabindex="-1"></a><span class="sc">\]</span></span>
<span id="cb9-305"><a href="#cb9-305" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-306"><a href="#cb9-306" aria-hidden="true" tabindex="-1"></a>with</span>
<span id="cb9-307"><a href="#cb9-307" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-308"><a href="#cb9-308" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="sc">\(</span>lpha_k \ge 0<span class="sc">\)</span>  </span>
<span id="cb9-309"><a href="#cb9-309" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="sc">\(</span>\sum_k lpha_k = 1<span class="sc">\)</span></span>
<span id="cb9-310"><a href="#cb9-310" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-311"><a href="#cb9-311" aria-hidden="true" tabindex="-1"></a>Weights <span class="sc">\(</span>lpha<span class="sc">\)</span> are chosen to minimize cross-validated loss (e.g., squared error of influence curves).</span>
<span id="cb9-312"><a href="#cb9-312" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-313"><a href="#cb9-313" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb9-314"><a href="#cb9-314" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-315"><a href="#cb9-315" aria-hidden="true" tabindex="-1"></a><span class="fu">## 6. Example Hybrid Workflow (Conceptual)</span></span>
<span id="cb9-316"><a href="#cb9-316" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-317"><a href="#cb9-317" aria-hidden="true" tabindex="-1"></a>Consider:</span>
<span id="cb9-318"><a href="#cb9-318" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-319"><a href="#cb9-319" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>RCT: experimental vs placebo  </span>
<span id="cb9-320"><a href="#cb9-320" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>RWD: observational comparison between experimental drug and standard-of-care  </span>
<span id="cb9-321"><a href="#cb9-321" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-322"><a href="#cb9-322" aria-hidden="true" tabindex="-1"></a><span class="fu">### 6.1 TMLE using RCT only</span></span>
<span id="cb9-323"><a href="#cb9-323" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-324"><a href="#cb9-324" aria-hidden="true" tabindex="-1"></a><span class="in">```r</span></span>
<span id="cb9-325"><a href="#cb9-325" aria-hidden="true" tabindex="-1"></a>tmle_rct <span class="ot">&lt;-</span> <span class="fu">tmle</span>(</span>
<span id="cb9-326"><a href="#cb9-326" aria-hidden="true" tabindex="-1"></a>  <span class="at">Y =</span> Y_rct,</span>
<span id="cb9-327"><a href="#cb9-327" aria-hidden="true" tabindex="-1"></a>  <span class="at">A =</span> A_rct,</span>
<span id="cb9-328"><a href="#cb9-328" aria-hidden="true" tabindex="-1"></a>  <span class="at">W =</span> W_rct,</span>
<span id="cb9-329"><a href="#cb9-329" aria-hidden="true" tabindex="-1"></a>  <span class="at">family =</span> <span class="st">"binomial"</span>,</span>
<span id="cb9-330"><a href="#cb9-330" aria-hidden="true" tabindex="-1"></a>  <span class="at">Q.SL.library =</span> <span class="fu">c</span>(<span class="st">"SL.glm"</span>, <span class="st">"SL.ranger"</span>),</span>
<span id="cb9-331"><a href="#cb9-331" aria-hidden="true" tabindex="-1"></a>  <span class="at">g.SL.library =</span> <span class="fu">c</span>(<span class="st">"SL.glm"</span>, <span class="st">"SL.ranger"</span>)</span>
<span id="cb9-332"><a href="#cb9-332" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb9-333"><a href="#cb9-333" aria-hidden="true" tabindex="-1"></a>psi_rct <span class="ot">&lt;-</span> tmle_rct<span class="sc">$</span>estimates<span class="sc">$</span>ATE<span class="sc">$</span>psi</span>
<span id="cb9-334"><a href="#cb9-334" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb9-335"><a href="#cb9-335" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-336"><a href="#cb9-336" aria-hidden="true" tabindex="-1"></a><span class="fu">### 6.2 TMLE using RWD (careful confounding control)</span></span>
<span id="cb9-337"><a href="#cb9-337" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-338"><a href="#cb9-338" aria-hidden="true" tabindex="-1"></a><span class="in">```r</span></span>
<span id="cb9-339"><a href="#cb9-339" aria-hidden="true" tabindex="-1"></a>tmle_rwd <span class="ot">&lt;-</span> <span class="fu">tmle</span>(</span>
<span id="cb9-340"><a href="#cb9-340" aria-hidden="true" tabindex="-1"></a>  <span class="at">Y =</span> Y_rwd,</span>
<span id="cb9-341"><a href="#cb9-341" aria-hidden="true" tabindex="-1"></a>  <span class="at">A =</span> A_rwd,</span>
<span id="cb9-342"><a href="#cb9-342" aria-hidden="true" tabindex="-1"></a>  <span class="at">W =</span> W_rwd,</span>
<span id="cb9-343"><a href="#cb9-343" aria-hidden="true" tabindex="-1"></a>  <span class="at">family =</span> <span class="st">"binomial"</span>,</span>
<span id="cb9-344"><a href="#cb9-344" aria-hidden="true" tabindex="-1"></a>  <span class="at">Q.SL.library =</span> <span class="fu">c</span>(<span class="st">"SL.glm"</span>, <span class="st">"SL.ranger"</span>),</span>
<span id="cb9-345"><a href="#cb9-345" aria-hidden="true" tabindex="-1"></a>  <span class="at">g.SL.library =</span> <span class="fu">c</span>(<span class="st">"SL.glm"</span>, <span class="st">"SL.ranger"</span>)</span>
<span id="cb9-346"><a href="#cb9-346" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb9-347"><a href="#cb9-347" aria-hidden="true" tabindex="-1"></a>psi_rwd <span class="ot">&lt;-</span> tmle_rwd<span class="sc">$</span>estimates<span class="sc">$</span>ATE<span class="sc">$</span>psi</span>
<span id="cb9-348"><a href="#cb9-348" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb9-349"><a href="#cb9-349" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-350"><a href="#cb9-350" aria-hidden="true" tabindex="-1"></a><span class="fu">### 6.3 Pooled-source TMLE</span></span>
<span id="cb9-351"><a href="#cb9-351" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-352"><a href="#cb9-352" aria-hidden="true" tabindex="-1"></a><span class="in">```r</span></span>
<span id="cb9-353"><a href="#cb9-353" aria-hidden="true" tabindex="-1"></a>Y_pool <span class="ot">&lt;-</span> <span class="fu">c</span>(Y_rct, Y_rwd)</span>
<span id="cb9-354"><a href="#cb9-354" aria-hidden="true" tabindex="-1"></a>A_pool <span class="ot">&lt;-</span> <span class="fu">c</span>(A_rct, A_rwd)</span>
<span id="cb9-355"><a href="#cb9-355" aria-hidden="true" tabindex="-1"></a>W_pool <span class="ot">&lt;-</span> <span class="fu">rbind</span>(W_rct, W_rwd)</span>
<span id="cb9-356"><a href="#cb9-356" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-357"><a href="#cb9-357" aria-hidden="true" tabindex="-1"></a>tmle_pool <span class="ot">&lt;-</span> <span class="fu">tmle</span>(</span>
<span id="cb9-358"><a href="#cb9-358" aria-hidden="true" tabindex="-1"></a>  <span class="at">Y =</span> Y_pool,</span>
<span id="cb9-359"><a href="#cb9-359" aria-hidden="true" tabindex="-1"></a>  <span class="at">A =</span> A_pool,</span>
<span id="cb9-360"><a href="#cb9-360" aria-hidden="true" tabindex="-1"></a>  <span class="at">W =</span> W_pool,</span>
<span id="cb9-361"><a href="#cb9-361" aria-hidden="true" tabindex="-1"></a>  <span class="at">family =</span> <span class="st">"binomial"</span>,</span>
<span id="cb9-362"><a href="#cb9-362" aria-hidden="true" tabindex="-1"></a>  <span class="at">Q.SL.library =</span> <span class="fu">c</span>(<span class="st">"SL.glm"</span>, <span class="st">"SL.ranger"</span>),</span>
<span id="cb9-363"><a href="#cb9-363" aria-hidden="true" tabindex="-1"></a>  <span class="at">g.SL.library =</span> <span class="fu">c</span>(<span class="st">"SL.glm"</span>, <span class="st">"SL.ranger"</span>)</span>
<span id="cb9-364"><a href="#cb9-364" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb9-365"><a href="#cb9-365" aria-hidden="true" tabindex="-1"></a>psi_pool <span class="ot">&lt;-</span> tmle_pool<span class="sc">$</span>estimates<span class="sc">$</span>ATE<span class="sc">$</span>psi</span>
<span id="cb9-366"><a href="#cb9-366" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb9-367"><a href="#cb9-367" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-368"><a href="#cb9-368" aria-hidden="true" tabindex="-1"></a><span class="fu">### 6.4 Adaptive combination (A-TMLE style idea)</span></span>
<span id="cb9-369"><a href="#cb9-369" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-370"><a href="#cb9-370" aria-hidden="true" tabindex="-1"></a><span class="in">```r</span></span>
<span id="cb9-371"><a href="#cb9-371" aria-hidden="true" tabindex="-1"></a>candidates <span class="ot">&lt;-</span> <span class="fu">c</span>(psi_rct, psi_rwd, psi_pool)</span>
<span id="cb9-372"><a href="#cb9-372" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-373"><a href="#cb9-373" aria-hidden="true" tabindex="-1"></a><span class="co"># Placeholder: in practice, you would build a loss function based on influence curves</span></span>
<span id="cb9-374"><a href="#cb9-374" aria-hidden="true" tabindex="-1"></a><span class="co"># and use constrained optimization (e.g., nnls) with cross-validation to find weights.</span></span>
<span id="cb9-375"><a href="#cb9-375" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-376"><a href="#cb9-376" aria-hidden="true" tabindex="-1"></a>weights <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">0.6</span>, <span class="fl">0.0</span>, <span class="fl">0.4</span>)  <span class="co"># e.g., chosen by cross-validation</span></span>
<span id="cb9-377"><a href="#cb9-377" aria-hidden="true" tabindex="-1"></a>weights <span class="ot">&lt;-</span> weights <span class="sc">/</span> <span class="fu">sum</span>(weights)</span>
<span id="cb9-378"><a href="#cb9-378" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-379"><a href="#cb9-379" aria-hidden="true" tabindex="-1"></a>psi_atmle <span class="ot">&lt;-</span> <span class="fu">sum</span>(weights <span class="sc">*</span> candidates)</span>
<span id="cb9-380"><a href="#cb9-380" aria-hidden="true" tabindex="-1"></a>psi_atmle</span>
<span id="cb9-381"><a href="#cb9-381" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb9-382"><a href="#cb9-382" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-383"><a href="#cb9-383" aria-hidden="true" tabindex="-1"></a>In a true A-TMLE implementation, the weights would be:</span>
<span id="cb9-384"><a href="#cb9-384" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-385"><a href="#cb9-385" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Estimated based on CV risk  </span>
<span id="cb9-386"><a href="#cb9-386" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Possibly constrained to ensure heavier emphasis on RCT-based estimators  </span>
<span id="cb9-387"><a href="#cb9-387" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-388"><a href="#cb9-388" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb9-389"><a href="#cb9-389" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-390"><a href="#cb9-390" aria-hidden="true" tabindex="-1"></a><span class="fu">## 7. Practical Considerations and Diagnostics for Hybrid Designs</span></span>
<span id="cb9-391"><a href="#cb9-391" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-392"><a href="#cb9-392" aria-hidden="true" tabindex="-1"></a>:::{.callout-important}</span>
<span id="cb9-393"><a href="#cb9-393" aria-hidden="true" tabindex="-1"></a><span class="fu">## 7.1 Harmonization</span></span>
<span id="cb9-394"><a href="#cb9-394" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-395"><a href="#cb9-395" aria-hidden="true" tabindex="-1"></a>Before attempting hybrid estimation, you must ensure that the two data sources are speaking the same language. This is often the most labor-intensive step.</span>
<span id="cb9-396"><a href="#cb9-396" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-397"><a href="#cb9-397" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Align endpoint definitions and censoring rules</span>
<span id="cb9-398"><a href="#cb9-398" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Harmonize covariates (coding, units, ranges)</span>
<span id="cb9-399"><a href="#cb9-399" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Confirm consistent definition of “treatment” across sources</span>
<span id="cb9-400"><a href="#cb9-400" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb9-401"><a href="#cb9-401" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-402"><a href="#cb9-402" aria-hidden="true" tabindex="-1"></a>:::{.callout-tip}</span>
<span id="cb9-403"><a href="#cb9-403" aria-hidden="true" tabindex="-1"></a><span class="fu">## 7.2 Assess Similarity Between RCT and RWD</span></span>
<span id="cb9-404"><a href="#cb9-404" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-405"><a href="#cb9-405" aria-hidden="true" tabindex="-1"></a>Check covariate distributions before you borrow. Visualization is your first line of defense:</span>
<span id="cb9-406"><a href="#cb9-406" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-407"><a href="#cb9-407" aria-hidden="true" tabindex="-1"></a><span class="in">```r</span></span>
<span id="cb9-408"><a href="#cb9-408" aria-hidden="true" tabindex="-1"></a><span class="fu">bind_rows</span>(</span>
<span id="cb9-409"><a href="#cb9-409" aria-hidden="true" tabindex="-1"></a>  W_rct <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">source =</span> “RCT”),</span>
<span id="cb9-410"><a href="#cb9-410" aria-hidden="true" tabindex="-1"></a>  W_rwd <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">source =</span> “RWD”)</span>
<span id="cb9-411"><a href="#cb9-411" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb9-412"><a href="#cb9-412" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="sc">-</span>source) <span class="sc">%&gt;%</span></span>
<span id="cb9-413"><a href="#cb9-413" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> value, <span class="at">fill =</span> source)) <span class="sc">+</span></span>
<span id="cb9-414"><a href="#cb9-414" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="at">alpha =</span> <span class="fl">0.4</span>) <span class="sc">+</span></span>
<span id="cb9-415"><a href="#cb9-415" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> name, <span class="at">scales =</span> “free”)</span>
<span id="cb9-416"><a href="#cb9-416" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb9-417"><a href="#cb9-417" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-418"><a href="#cb9-418" aria-hidden="true" tabindex="-1"></a>Look for:</span>
<span id="cb9-419"><a href="#cb9-419" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-420"><a href="#cb9-420" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Large discrepancies --&gt; may require transportability modeling</span>
<span id="cb9-421"><a href="#cb9-421" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Non-overlapping regions --&gt; positivity issues</span>
<span id="cb9-422"><a href="#cb9-422" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb9-423"><a href="#cb9-423" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-424"><a href="#cb9-424" aria-hidden="true" tabindex="-1"></a>:::{.callout-warning}</span>
<span id="cb9-425"><a href="#cb9-425" aria-hidden="true" tabindex="-1"></a><span class="fu">## 7.3 Sensitivity Analyses Are Not Optional</span></span>
<span id="cb9-426"><a href="#cb9-426" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-427"><a href="#cb9-427" aria-hidden="true" tabindex="-1"></a>Every hybrid analysis should include sensitivity checks that quantify how much the result depends on the external data:</span>
<span id="cb9-428"><a href="#cb9-428" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-429"><a href="#cb9-429" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Re-estimate using RCT-only TMLE (your “no-borrowing” benchmark)</span>
<span id="cb9-430"><a href="#cb9-430" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Vary the degree of borrowing (e.g., by up-weighting/down-weighting RWD in hybrid estimators)</span>
<span id="cb9-431"><a href="#cb9-431" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Use E-values or quantitative bias analysis (QBA) to examine the impact of unmeasured confounding in the RWD component</span>
<span id="cb9-432"><a href="#cb9-432" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Apply negative control analyses in the RWD part</span>
<span id="cb9-433"><a href="#cb9-433" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-434"><a href="#cb9-434" aria-hidden="true" tabindex="-1"></a>If your conclusions change dramatically depending on how much RWD you include, that is a signal that the external data may be introducing bias rather than reducing variance.</span>
<span id="cb9-435"><a href="#cb9-435" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb9-436"><a href="#cb9-436" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-437"><a href="#cb9-437" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb9-438"><a href="#cb9-438" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-439"><a href="#cb9-439" aria-hidden="true" tabindex="-1"></a><span class="fu">## 8. When to Use Hybrid Designs (and When Not To)</span></span>
<span id="cb9-440"><a href="#cb9-440" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-441"><a href="#cb9-441" aria-hidden="true" tabindex="-1"></a>Hybrid designs are **appropriate** when:</span>
<span id="cb9-442"><a href="#cb9-442" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-443"><a href="#cb9-443" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>RWD is of reasonable quality  </span>
<span id="cb9-444"><a href="#cb9-444" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Key confounders in RWD are measured  </span>
<span id="cb9-445"><a href="#cb9-445" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Outcome definitions are compatible  </span>
<span id="cb9-446"><a href="#cb9-446" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>There is substantial overlap in covariate distributions  </span>
<span id="cb9-447"><a href="#cb9-447" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>The trial alone is underpowered or narrow in scope  </span>
<span id="cb9-448"><a href="#cb9-448" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-449"><a href="#cb9-449" aria-hidden="true" tabindex="-1"></a>:::{.callout-caution}</span>
<span id="cb9-450"><a href="#cb9-450" aria-hidden="true" tabindex="-1"></a><span class="fu">## When Hybrid Designs Are Inappropriate</span></span>
<span id="cb9-451"><a href="#cb9-451" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-452"><a href="#cb9-452" aria-hidden="true" tabindex="-1"></a>They may be **inappropriate** when:</span>
<span id="cb9-453"><a href="#cb9-453" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-454"><a href="#cb9-454" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**RWD is subject to severe unmeasured confounding**: If the observational data lack key confounders (e.g., disease severity, performance status), borrowing from RWD can introduce more bias than it resolves.</span>
<span id="cb9-455"><a href="#cb9-455" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Data sources are poorly harmonized**: If outcome definitions, covariate coding, or follow-up schedules differ substantially and cannot be reconciled, the hybrid estimator is comparing incompatible quantities.</span>
<span id="cb9-456"><a href="#cb9-456" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**There is little overlap in covariate or treatment patterns**: If the trial population and RWD population occupy different regions of the covariate space, extrapolation replaces estimation.</span>
<span id="cb9-457"><a href="#cb9-457" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**The trial is already well-powered for the primary endpoint**: In this case, the marginal precision gain from RWD may not justify the additional assumptions and complexity.</span>
<span id="cb9-458"><a href="#cb9-458" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-459"><a href="#cb9-459" aria-hidden="true" tabindex="-1"></a>In those cases, a pure RCT analysis with careful interpretation may be preferable. Adding RWD is not always better -- it is better only when the assumptions hold and the data quality warrants it.</span>
<span id="cb9-460"><a href="#cb9-460" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb9-461"><a href="#cb9-461" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-462"><a href="#cb9-462" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb9-463"><a href="#cb9-463" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-464"><a href="#cb9-464" aria-hidden="true" tabindex="-1"></a><span class="fu">## 9. Summary</span></span>
<span id="cb9-465"><a href="#cb9-465" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-466"><a href="#cb9-466" aria-hidden="true" tabindex="-1"></a>:::{.callout-tip}</span>
<span id="cb9-467"><a href="#cb9-467" aria-hidden="true" tabindex="-1"></a><span class="fu">## Chapter Takeaways</span></span>
<span id="cb9-468"><a href="#cb9-468" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-469"><a href="#cb9-469" aria-hidden="true" tabindex="-1"></a>Hybrid RCT-RWD designs extend the causal roadmap to a richer evidence ecosystem:</span>
<span id="cb9-470"><a href="#cb9-470" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-471"><a href="#cb9-471" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**External controls** can augment sparse trial control arms</span>
<span id="cb9-472"><a href="#cb9-472" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Transport and generalizability methods** can extend findings to broader populations</span>
<span id="cb9-473"><a href="#cb9-473" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**ES-CV-TMLE** leverages RWD for nuisance modeling while preserving internal validity</span>
<span id="cb9-474"><a href="#cb9-474" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**A-TMLE** adaptively combines estimators from multiple sources using targeted learning and cross-validation</span>
<span id="cb9-475"><a href="#cb9-475" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-476"><a href="#cb9-476" aria-hidden="true" tabindex="-1"></a>Used carefully, these tools can:</span>
<span id="cb9-477"><a href="#cb9-477" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-478"><a href="#cb9-478" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Improve precision</span>
<span id="cb9-479"><a href="#cb9-479" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Enhance generalizability</span>
<span id="cb9-480"><a href="#cb9-480" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Provide robust, transparent evidence that respects the strengths and limitations of both RCT and RWD</span>
<span id="cb9-481"><a href="#cb9-481" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-482"><a href="#cb9-482" aria-hidden="true" tabindex="-1"></a>The overarching principle for MPH-trained epidemiologists: hybrid designs do not weaken the RCT -- they extend it. But the extension is only as trustworthy as the assumptions and data quality behind the RWD component. Always report the RCT-only result alongside the hybrid result so readers can judge for themselves.</span>
<span id="cb9-483"><a href="#cb9-483" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb9-484"><a href="#cb9-484" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-487"><a href="#cb9-487" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb9-488"><a href="#cb9-488" aria-hidden="true" tabindex="-1"></a><span class="fu">sessionInfo</span>()</span>
<span id="cb9-489"><a href="#cb9-489" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb9-490"><a href="#cb9-490" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-491"><a href="#cb9-491" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb9-492"><a href="#cb9-492" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-493"><a href="#cb9-493" aria-hidden="true" tabindex="-1"></a><span class="fu">## Software Implementation (R)</span></span>
<span id="cb9-494"><a href="#cb9-494" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-495"><a href="#cb9-495" aria-hidden="true" tabindex="-1"></a>This example demonstrates an **external control arm** analysis skeleton where a randomized trial is augmented with real-world data (RWD). We simulate an RCT treatment arm and an external RWD control arm, then estimate the ATE using TMLE with study-membership adjustment.</span>
<span id="cb9-496"><a href="#cb9-496" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-497"><a href="#cb9-497" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Simulates a small RCT (treatment arm only) and a larger RWD cohort (controls)</span>
<span id="cb9-498"><a href="#cb9-498" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Includes a study-membership indicator $S$ to adjust for systematic differences</span>
<span id="cb9-499"><a href="#cb9-499" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Uses <span class="in">`tmle`</span> to estimate the treatment effect while adjusting for $W$ and $S$</span>
<span id="cb9-500"><a href="#cb9-500" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Notes where specialized packages like <span class="in">`EScvtmle`</span> would extend this approach</span>
<span id="cb9-501"><a href="#cb9-501" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-504"><a href="#cb9-504" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb9-505"><a href="#cb9-505" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb9-506"><a href="#cb9-506" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb9-507"><a href="#cb9-507" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-508"><a href="#cb9-508" aria-hidden="true" tabindex="-1"></a><span class="do">## ── Simulate RCT treatment arm ──</span></span>
<span id="cb9-509"><a href="#cb9-509" aria-hidden="true" tabindex="-1"></a>n_rct <span class="ot">&lt;-</span> <span class="dv">150</span></span>
<span id="cb9-510"><a href="#cb9-510" aria-hidden="true" tabindex="-1"></a>W1_rct <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(n_rct, <span class="at">mean =</span> <span class="fl">0.2</span>)</span>
<span id="cb9-511"><a href="#cb9-511" aria-hidden="true" tabindex="-1"></a>W2_rct <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(n_rct, <span class="dv">1</span>, <span class="fl">0.4</span>)</span>
<span id="cb9-512"><a href="#cb9-512" aria-hidden="true" tabindex="-1"></a>A_rct  <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">1</span>, n_rct)  <span class="co"># all treated</span></span>
<span id="cb9-513"><a href="#cb9-513" aria-hidden="true" tabindex="-1"></a>Y_rct  <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(n_rct, <span class="dv">1</span>, <span class="fu">plogis</span>(<span class="sc">-</span><span class="dv">1</span> <span class="sc">+</span> <span class="fl">0.6</span> <span class="sc">*</span> <span class="dv">1</span> <span class="sc">+</span> <span class="fl">0.5</span> <span class="sc">*</span> W1_rct <span class="sc">+</span> <span class="fl">0.3</span> <span class="sc">*</span> W2_rct))</span>
<span id="cb9-514"><a href="#cb9-514" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-515"><a href="#cb9-515" aria-hidden="true" tabindex="-1"></a><span class="do">## ── Simulate RWD external controls ──</span></span>
<span id="cb9-516"><a href="#cb9-516" aria-hidden="true" tabindex="-1"></a>n_rwd <span class="ot">&lt;-</span> <span class="dv">400</span></span>
<span id="cb9-517"><a href="#cb9-517" aria-hidden="true" tabindex="-1"></a>W1_rwd <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(n_rwd, <span class="at">mean =</span> <span class="sc">-</span><span class="fl">0.1</span>)   <span class="co"># slight covariate shift</span></span>
<span id="cb9-518"><a href="#cb9-518" aria-hidden="true" tabindex="-1"></a>W2_rwd <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(n_rwd, <span class="dv">1</span>, <span class="fl">0.5</span>)</span>
<span id="cb9-519"><a href="#cb9-519" aria-hidden="true" tabindex="-1"></a>A_rwd  <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">0</span>, n_rwd)  <span class="co"># all control</span></span>
<span id="cb9-520"><a href="#cb9-520" aria-hidden="true" tabindex="-1"></a>Y_rwd  <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(n_rwd, <span class="dv">1</span>, <span class="fu">plogis</span>(<span class="sc">-</span><span class="dv">1</span> <span class="sc">+</span> <span class="fl">0.6</span> <span class="sc">*</span> <span class="dv">0</span> <span class="sc">+</span> <span class="fl">0.5</span> <span class="sc">*</span> W1_rwd <span class="sc">+</span> <span class="fl">0.3</span> <span class="sc">*</span> W2_rwd))</span>
<span id="cb9-521"><a href="#cb9-521" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-522"><a href="#cb9-522" aria-hidden="true" tabindex="-1"></a><span class="do">## ── Combined analysis dataset ──</span></span>
<span id="cb9-523"><a href="#cb9-523" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb9-524"><a href="#cb9-524" aria-hidden="true" tabindex="-1"></a>  <span class="at">W1 =</span> <span class="fu">c</span>(W1_rct, W1_rwd),</span>
<span id="cb9-525"><a href="#cb9-525" aria-hidden="true" tabindex="-1"></a>  <span class="at">W2 =</span> <span class="fu">c</span>(W2_rct, W2_rwd),</span>
<span id="cb9-526"><a href="#cb9-526" aria-hidden="true" tabindex="-1"></a>  <span class="at">S  =</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="dv">1</span>, n_rct), <span class="fu">rep</span>(<span class="dv">0</span>, n_rwd)),   <span class="co"># study membership</span></span>
<span id="cb9-527"><a href="#cb9-527" aria-hidden="true" tabindex="-1"></a>  <span class="at">A  =</span> <span class="fu">c</span>(A_rct, A_rwd),</span>
<span id="cb9-528"><a href="#cb9-528" aria-hidden="true" tabindex="-1"></a>  <span class="at">Y  =</span> <span class="fu">c</span>(Y_rct, Y_rwd)</span>
<span id="cb9-529"><a href="#cb9-529" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb9-530"><a href="#cb9-530" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-531"><a href="#cb9-531" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">requireNamespace</span>(<span class="st">"tmle"</span>, <span class="at">quietly =</span> <span class="cn">TRUE</span>)) {</span>
<span id="cb9-532"><a href="#cb9-532" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(tmle)</span>
<span id="cb9-533"><a href="#cb9-533" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Include study indicator S as a covariate to adjust for</span></span>
<span id="cb9-534"><a href="#cb9-534" aria-hidden="true" tabindex="-1"></a>  <span class="do">## population differences between RCT and RWD</span></span>
<span id="cb9-535"><a href="#cb9-535" aria-hidden="true" tabindex="-1"></a>  W <span class="ot">&lt;-</span> dat[, <span class="fu">c</span>(<span class="st">"W1"</span>, <span class="st">"W2"</span>, <span class="st">"S"</span>)]</span>
<span id="cb9-536"><a href="#cb9-536" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-537"><a href="#cb9-537" aria-hidden="true" tabindex="-1"></a>  fit <span class="ot">&lt;-</span> <span class="fu">tmle</span>(</span>
<span id="cb9-538"><a href="#cb9-538" aria-hidden="true" tabindex="-1"></a>    <span class="at">Y =</span> dat<span class="sc">$</span>Y, <span class="at">A =</span> dat<span class="sc">$</span>A, <span class="at">W =</span> W,</span>
<span id="cb9-539"><a href="#cb9-539" aria-hidden="true" tabindex="-1"></a>    <span class="at">family =</span> <span class="st">"binomial"</span>,</span>
<span id="cb9-540"><a href="#cb9-540" aria-hidden="true" tabindex="-1"></a>    <span class="at">Q.SL.library =</span> <span class="fu">c</span>(<span class="st">"SL.glm"</span>, <span class="st">"SL.mean"</span>),</span>
<span id="cb9-541"><a href="#cb9-541" aria-hidden="true" tabindex="-1"></a>    <span class="at">g.SL.library  =</span> <span class="fu">c</span>(<span class="st">"SL.glm"</span>, <span class="st">"SL.mean"</span>)</span>
<span id="cb9-542"><a href="#cb9-542" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb9-543"><a href="#cb9-543" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-544"><a href="#cb9-544" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"── Hybrid RCT + RWD external control analysis ──</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb9-545"><a href="#cb9-545" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"ATE (risk difference):"</span>, <span class="fu">round</span>(fit<span class="sc">$</span>estimates<span class="sc">$</span>ATE<span class="sc">$</span>psi, <span class="dv">4</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb9-546"><a href="#cb9-546" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"95% CI:"</span>, <span class="fu">round</span>(fit<span class="sc">$</span>estimates<span class="sc">$</span>ATE<span class="sc">$</span>CI, <span class="dv">4</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb9-547"><a href="#cb9-547" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">Note: For more sophisticated approaches, see:</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb9-548"><a href="#cb9-548" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"  - EScvtmle: external-source cross-validated TMLE</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb9-549"><a href="#cb9-549" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"  - A-TMLE: adaptive TMLE for data-adaptive borrowing</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb9-550"><a href="#cb9-550" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb9-551"><a href="#cb9-551" aria-hidden="true" tabindex="-1"></a>  <span class="fu">message</span>(<span class="st">"Install the 'tmle' package:  install.packages('tmle')"</span>)</span>
<span id="cb9-552"><a href="#cb9-552" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb9-553"><a href="#cb9-553" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
</code><button title="Copy to Clipboard" class="code-copy-button" data-in-quarto-modal=""><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->




</body></html>