---
title: "Causal Learning Handbook"
---

# Welcome! {.unnumbered}

This handbook introduces the **Causal Roadmap**, **Targeted Maximum Likelihood Estimation (TMLE)**, and **Super Learner** for modern causal inference in epidemiology, with an emphasis on pharmacoepidemiology and clinical trial analysis. Each chapter builds on the previous ones, progressing from foundational concepts to advanced methods with worked R code examples throughout.

## How to use this book

The chapters are organized into three parts plus appendices. Part I builds the conceptual foundations you need before running any estimator. Part II walks through each major estimation strategy with hands-on code. Part III covers advanced topics that extend these methods to realistic, complex settings. You can read the book front-to-back or jump to specific chapters as needed.

---

## Part I: Foundations

These chapters establish the conceptual framework for causal inference --- why standard regression is not enough, how the Causal Roadmap structures an analysis, and how we formally link causal questions to quantities we can estimate from data.

| Chapter | Description |
|---------|-------------|
| [1.1 Regression vs. Causal Inference](01-01-regression-vs-causal.qmd) | Why regression coefficients are not causal effects, and what the counterfactual framework offers instead. |
| [1.2 The Causal Roadmap](01-02-causal-roadmap.qmd) | The six-step Causal Roadmap for structuring any causal analysis: from question to interpretation. |
| [1.3 Identification and Estimands](01-03-identification-estimands.qmd) | Formal identification assumptions (consistency, exchangeability, positivity) and how to translate causal parameters into statistical estimands. |
| [Causal Roadmap Tutorial](roadmap_tutorial.Rmd) | An interactive, end-to-end walkthrough of the Causal Roadmap applied to a pharmacoepidemiology example, with full R code for g-computation, IPTW, and TMLE. |

---

## Part II: Estimation Methods

These chapters cover the core estimation approaches for causal inference, from outcome modeling to doubly robust methods, with progressive worked examples in R.

| Chapter | Description |
|---------|-------------|
| [2.1 G-Computation](02-01-gcomputation.qmd) | Outcome modeling and standardization: fit a model for $E[Y \mid A, W]$, predict under interventions, and average to get marginal causal effects. |
| [2.2 Inverse Probability of Treatment Weighting](02-02-iptw.qmd) | Propensity-score-based estimation: reweight the sample to create a pseudo-population where treatment is independent of confounders. Covers stabilized weights, truncation, and diagnostics. |
| [2.3 Doubly Robust Estimation and TMLE](02-03-doubly-robust-tmle.qmd) | AIPW and TMLE side by side: why combining outcome and treatment models gives you two chances to get it right, with efficient influence curve--based inference. |
| [2.4 From Question to Estimate --- TMLE in Practice](02-04-tmle-teaching-examples.qmd) | A progressive, illustrated walkthrough comparing naive, g-computation, IPTW, AIPW, and TMLE estimators on a single cardiovascular safety dataset. Includes diagnostic checks and Super Learner integration. |
| [SuperLearner and Machine Learning](superlearner.Rmd) | How ensemble machine learning (SuperLearner) improves nuisance function estimation for causal inference: cross-validation, loss functions, library specification, and integration with TMLE. |

---

## Part III: Advanced Topics

These chapters extend the core methods to realistic settings: longitudinal data with time-varying confounding, effect modification, advanced diagnostics, hybrid trial--observational designs, and mediation analysis.

| Chapter | Description |
|---------|-------------|
| [3.3 Longitudinal Case Study](03-03-longitudinal-case-study.qmd) | A worked case study applying the Causal Roadmap to a longitudinal pharmacoepidemiology setting with time-varying confounding (denosumab vs. zoledronic acid). |
| [3.4 Effect Modification](03-04-effect-modification.qmd) | Conditional average treatment effects (CATE), TMLE-based subgroup analyses, and causal forests for heterogeneous treatment effect estimation. |
| [3.5 Advanced Diagnostics](03-05-advanced-diagnostics.qmd) | E-values, quantitative bias analysis, negative control outcomes and exposures, influence curve diagnostics, and calibration checks for causal analyses. |
| [3.6 RWD Meets RCT: Hybrid Designs](03-06-rwd-meets-rct-hybrid-designs.qmd) | External control arms, transportability, ES-CV-TMLE, and A-TMLE for combining randomized and real-world data sources. |
| [3.7 Imperfect Adherence and Longitudinal TMLE](03-07-longitudinal-td-confounding.qmd) | Time-dependent confounding affected by prior treatment, and longitudinal TMLE (L-TMLE) for treatment-policy and per-protocol estimands. |
| [3.8 TMLE in the Clean-Room Framework](03-08-tmle-clean-room.qmd) | A from-scratch, pedagogical implementation of TMLE with no package dependencies --- every step transparent and annotated. |
| [3.9 An Illustrated Guide to Longitudinal TMLE](03-09-illustrated-ltmle.qmd) | A visual, step-by-step guide to L-TMLE: backwards sequential regression, cumulative treatment probabilities, and time-step-specific targeting, following the KH Stats style. |
| [3.10 TMLE for Mediation Analysis](03-10-tmle-mediation.qmd) | Natural direct and indirect effects via TMLE: density ratio clever covariates, Monte Carlo integration, and cross-world assumptions for mediation decomposition. |
| [3.11 Estimands in Time-to-Event Safety Analyses](03-11-estimands-tte-safety.qmd) | How treatment-policy, while-on-treatment, and hypothetical estimand strategies change what a safety analysis measures, with simulation-based comparisons of KM, IPCW, and TMLE estimators. |

---

## Appendices

| Chapter | Description |
|---------|-------------|
| [Common Pitfalls](common-pitfalls.Rmd) | A catalog of the most frequent mistakes in causal inference --- from confusing association with causation to ignoring positivity violations --- and how to avoid them. |
| [Annotated Bibliography](anotated_bibliography.Rmd) | Key readings in causal inference, targeted learning, and real-world evidence generation, with annotations summarizing each paper's contribution. |
| [Other Resources](other_resources.Rmd) | Links to external courses, tutorials, and reference sites for further learning. |

---

## Package installations

To run the code examples in this book, install the following R packages:

```{r}
#| eval: false

## Core CRAN packages
cran_pkgs <- c(
  "tidyverse", "here", "sandwich", "lmtest", "Matrix", "survival"
)

## Super Learner ecosystem
sl_pkgs <- c(
  "SuperLearner", "glmnet", "gam", "ranger", "randomForest", "xgboost"
)

## Targeted Learning and causal inference
causal_pkgs <- c(
  "tmle", "ltmle", "lmtp", "hal9001", "origami"
)

## Diagnostics and sensitivity analysis
diagnostic_pkgs <- c("EValue", "episensr", "causalsens")

## Combine and install missing packages
all_pkgs <- unique(c(cran_pkgs, sl_pkgs, causal_pkgs, diagnostic_pkgs))
installed <- rownames(installed.packages())
to_install <- setdiff(all_pkgs, installed)

if (length(to_install) > 0) {
  install.packages(to_install, dependencies = TRUE)
}
```
