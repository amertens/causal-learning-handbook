---
title: "Targeted Learning Workshop: Safety and Effectiveness of Osteoporosis Treatment"
author: "Targeted Learning Team"
format: html
---

# Introduction
## Workshop Goals
- Learn to use the **Targeted Learning roadmap** for causal inference.
- Apply **G-computation, IPTW, and TMLE** using R.
- Implement **Super Learner** for robust data-adaptive estimation.
- Design a **Targeted Learning-based Statistical Analysis Plan (SAP)** aligned with ICH E9(R1).

## Learning Outcomes
- Define and identify causal estimands.
- Compare classical and modern estimators.
- Apply TMLE to estimate treatment safety effects.
- Develop a pre-specified, reproducible SAP for real-world evidence.

# Module 1: Introduction to Causal Inference
## Motivation
- Estimating the causal effect of osteoporosis drug use on fracture and cardiovascular safety.
## The Causal Roadmap
1. Define the question and estimand.
2. Specify causal and statistical models.
3. Assess identifiability.
4. Choose estimators and perform inference.
## Data Example
- Observational dataset: women >50 with osteoporosis treatment.
- Exposure: bisphosphonate vs. selective estrogen receptor modulator.
- Outcome: cardiovascular adverse event.

# Module 2: Data Setup and Exploration
## Data Preprocessing
- Import, clean, and summarize variables.
- Identify confounders and missing data patterns.
## Variable Definitions
- `A`: exposure (treatment type)
- `Y`: outcome (adverse event)
- `W`: baseline covariates (age, comorbidities, medication history)
## Visualizing Data
- Covariate balance plots
- DAG for causal structure

# Module 3: G-Computation
## Concept
- Model outcome E[Y|A,W].
- Predict counterfactual outcomes for all individuals under each treatment.
## Implementation in R
```{r, eval=F}
library(SuperLearner)
Q.SL <- SuperLearner(Y, X, family=binomial(), SL.library=c("SL.glm","SL.glmnet","SL.xgboost"))
```
## Interpretation
- Estimate mean difference in predicted risk (ATE).
- Discuss bias under model misspecification.

# Module 4: Inverse Probability of Treatment Weighting (IPTW)
## Concept
- Estimate propensity score P(A|W).
- Weight each subject by inverse probability of observed treatment.
## Implementation in R
```{r, eval=F}
g.SL <- SuperLearner(A, W, family=binomial(), SL.library=c("SL.glm","SL.gam","SL.xgboost"))
```
## Diagnostics
- Check covariate balance after weighting.
- Plot stabilized weights.
## Interpretation
- Compare with G-computation estimates.

# Module 5: Targeted Maximum Likelihood Estimation (TMLE)
## Conceptual Framework
1. Initial outcome regression Q^0
2. Propensity score model g
3. Targeting step using clever covariate H(A,W)
4. Compute updated estimate Q^*
5. Estimate ATE
## Implementation
```{r, eval=F}
library(tmle)
tmle_fit <- tmle(Y, A, W, family="binomial", Q.SL.library=Q.SL.library, g.SL.library=g.SL.library)
summary(tmle_fit)
```
## Inference
- Efficient influence curve
- Standard errors and 95% CI

# Module 6: Super Learner and Machine Learning
## Why Super Learner?
- Combine algorithms for optimal predictive performance.
## Building a Library
- Include SL.glm, SL.gam, SL.xgboost, SL.ranger, SL.mean.
## Practical Tips
- Cross-validation folds
- Screening and variable selection
- Parallel computation

# Module 7: Sensitivity Analyses and Robustness Checks
## Assessing Assumptions
- Exchangeability, positivity, consistency
## Sensitivity Analyses
- Truncating extreme weights
- Comparing parametric vs. SL fits
- Assessing violations (e.g., unmeasured confounding)

# Module 8: Extending to Longitudinal or Survival Outcomes
## Introduction
- TMLE for time-to-event data (cardiovascular safety)
- Censoring and competing risks
## Using the lmtp Package
```{r, eval=F}
library(lmtp)
fit_lmtp <- lmtp_tmle(data, trt="drug", outcome="cv_event", time_vary=list(...))
```
## Interpretation
- Risk difference or hazard difference at time t
- Visualizing survival curves

# Module 9: Developing a Targeted Learning-based SAP
## Alignment with ICH E9(R1)
- Population, treatment, variable, intercurrent events, summary measure.
## Checklist
1. Define estimand.
2. Specify identification assumptions.
3. Describe analytic strategy (TMLE + SL).
4. Plan sensitivity analyses.
## Example Output
- Structured SAP for osteoporosis safety study.

# Module 10: Synthesis and Conclusions
- Compare estimates from G-computation, IPTW, TMLE.
- Discuss implications for regulatory-grade RWE.
- Next steps: extending to multi-arm or dynamic treatment analyses.

# References
- van der Laan MJ, Rose S. *Targeted Learning.* 2011
- Gruber S et al. *Developing a TL-Based SAP.* 2022
- Hernán MA, Robins JM. *Causal Inference: What If.* 2020
- Díaz I, Williams N. *lmtp package vignette.* 2023
